<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FTG Dashboard</title>
  
  <!-- PWA Meta Tags -->
  <meta name="description" content="Financial dashboard for FTG Builders">
  <meta name="theme-color" content="#1f2937">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="FTG Dashboard">
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json">
  
  <!-- PWA Icons -->
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16.png">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">

  <link rel="stylesheet" href="style.css?v=20251216o" />

  <!-- EmailJS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  
  <!-- html2canvas for chart screenshots -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  
  <!-- jsPDF for PDF generation -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <!-- SheetJS for Excel export -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <!-- ExcelJS for styled Excel export -->
  <script src="https://cdn.jsdelivr.net/npm/exceljs@4.4.0/dist/exceljs.min.js"></script>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
  <!-- Admin nav visibility fix - handles cached credentials on page load -->
  <script>
    (function() {
      var cached = localStorage.getItem('ftg_is_admin');
      var auth = localStorage.getItem('ftg_authenticated');
      var token = localStorage.getItem('ftg_session_token');
      
      // If authenticated but admin cache is missing, fetch it from API
      if (auth === 'true' && token && cached === null) {
        fetch('/api/verify-session', {
          headers: { 'Authorization': 'Bearer ' + token }
        })
        .then(function(r) { return r.json(); })
        .then(function(data) {
          if (data.success && data.user) {
            var role = data.user.role || '';
            var isAdmin = role.toLowerCase() === 'admin';
            localStorage.setItem('ftg_is_admin', isAdmin ? 'true' : 'false');
            localStorage.setItem('ftg_user_role', role);
            if (isAdmin) {
              var adminNav = document.getElementById('adminNavItem');
              if (adminNav) adminNav.classList.remove('hidden');
            }
          }
        })
        .catch(function(e) { console.log('Admin check failed:', e); });
      }
      
      // If cached as admin, show nav immediately when DOM is ready
      if (cached === 'true' && auth === 'true') {
        var checkNav = setInterval(function() {
          var adminNav = document.getElementById('adminNavItem');
          if (adminNav) {
            adminNav.classList.remove('hidden');
            clearInterval(checkNav);
          }
        }, 50);
        setTimeout(function() { clearInterval(checkNav); }, 3000);
      }
    })();
  </script>
  <!-- LOGIN SCREEN -->
  <div id="loginScreen" class="login-screen">
    <div class="login-box">
      <img src="logo.png" alt="FTG Logo" class="login-logo">
      <h2>FTG Dashboard</h2>
      <p>Please enter your email and password</p>
      <form id="loginForm" onsubmit="return doLogin(event)">
        <input type="email" id="loginUsername" placeholder="Email address" autocomplete="username">
        <input type="password" id="loginPassword" placeholder="Password" autocomplete="current-password">
        <button type="submit" id="loginBtn">Login</button>
      </form>
      
      <!-- 2FA Verification Form (hidden by default) -->
      <form id="twoFAForm" class="hidden" onsubmit="return verify2FA(event)">
        <p style="color:#6b7280;font-size:14px;margin-bottom:12px;">Enter the 6-digit code from your authenticator app</p>
        <input type="text" id="twoFACode" placeholder="000000" maxlength="8" autocomplete="one-time-code" style="text-align:center;font-size:24px;letter-spacing:8px;">
        <button type="submit" id="verify2FABtn">Verify</button>
        <a href="#" id="cancel2FALink" style="display:block;margin-top:10px;font-size:12px;color:#6b7280;">Cancel and go back</a>
      </form>
      
      <!-- Forgot Password Form (hidden by default) -->
      <form id="forgotPasswordForm" class="hidden" onsubmit="return requestPasswordReset(event)">
        <p style="color:#6b7280;font-size:14px;margin-bottom:12px;">Enter your email to receive a password reset link</p>
        <input type="email" id="resetEmail" placeholder="Email address" autocomplete="username">
        <button type="submit" id="resetPasswordBtn">Send Reset Link</button>
        <a href="#" id="cancelResetLink" style="display:block;margin-top:10px;font-size:12px;color:#6b7280;">Back to login</a>
      </form>
      
      <!-- Complete Password Reset Form (hidden by default) -->
      <form id="completeResetForm" class="hidden" onsubmit="return completePasswordReset(event)">
        <p style="color:#6b7280;font-size:14px;margin-bottom:12px;">Enter your new password</p>
        <input type="password" id="newResetPassword" placeholder="New password" autocomplete="new-password">
        <input type="password" id="confirmResetPassword" placeholder="Confirm password" autocomplete="new-password">
        <button type="submit" id="completeResetBtn">Set New Password</button>
      </form>
      
      <p id="loginError" class="login-error"></p>
      <p id="loginSuccess" class="login-success hidden" style="color:#10b981;font-size:14px;margin-top:10px;"></p>
      <a href="#" id="forgotPasswordLink" style="font-size:12px;color:#6b7280;text-decoration:underline;cursor:pointer;">Forgot password?</a>
    </div>
  </div>
  <script>
    var pending2FAToken = null;
    var pending2FAEmail = null;
    
    async function doLogin(event) {
      if (event) event.preventDefault();
      var email = document.getElementById('loginUsername').value.toLowerCase().trim();
      var pwd = document.getElementById('loginPassword').value;
      var err = document.getElementById('loginError');
      var btn = document.getElementById('loginBtn');
      
      if (!email) {
        err.textContent = 'Please enter your email address.';
        return false;
      }
      
      if (!pwd) {
        err.textContent = 'Please enter your password.';
        return false;
      }
      
      btn.disabled = true;
      btn.textContent = 'Logging in...';
      err.textContent = '';
      
      try {
        var response = await fetch('/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: email, password: pwd })
        });
        
        var data = await response.json();
        
        if (data.success) {
          if (data.requires_2fa) {
            // Show 2FA form
            pending2FAToken = data.twofa_token;
            pending2FAEmail = data.email;
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('twoFAForm').classList.remove('hidden');
            document.getElementById('forgotPasswordLink').classList.add('hidden');
            document.getElementById('twoFACode').focus();
            btn.disabled = false;
            btn.textContent = 'Login';
            return false;
          }
          
          completeLogin(data);
        } else {
          err.textContent = data.error || 'Login failed. Please try again.';
        }
      } catch (e) {
        console.error('Login error:', e);
        err.textContent = 'Connection error. Please try again.';
      }
      
      btn.disabled = false;
      btn.textContent = 'Login';
      return false;
    }
    
    function completeLogin(data) {
      localStorage.setItem('ftg_authenticated', 'true');
      localStorage.setItem('ftg_current_user', data.email);
      localStorage.setItem('ftg_session_token', data.token);
      
      // Cache role and admin status for immediate access on page refresh
      var role = data.role || '';
      var isAdmin = role.toLowerCase() === 'admin';
      localStorage.setItem('ftg_user_role', role);
      localStorage.setItem('ftg_is_admin', isAdmin ? 'true' : 'false');
      
      document.getElementById('loginScreen').classList.add('hidden');
      
      var userLabel = document.getElementById('currentUser');
      if (userLabel) userLabel.textContent = data.displayName;
      
      // Show admin nav immediately if user is admin
      if (isAdmin) {
        var adminNavItem = document.getElementById('adminNavItem');
        if (adminNavItem) adminNavItem.classList.remove('hidden');
        window.isAdminUser = true;
      }
      window.userRole = role;
      
      if (typeof loadUserPreferences === 'function') {
        setTimeout(function() { loadUserPreferences(); }, 100);
      }
      if (typeof checkAdminAccess === 'function') {
        setTimeout(function() { checkAdminAccess(); }, 100);
      }
    }
    
    async function verify2FA(event) {
      if (event) event.preventDefault();
      var code = document.getElementById('twoFACode').value.trim();
      var err = document.getElementById('loginError');
      var btn = document.getElementById('verify2FABtn');
      
      if (!code) {
        err.textContent = 'Please enter the verification code.';
        return false;
      }
      
      btn.disabled = true;
      btn.textContent = 'Verifying...';
      err.textContent = '';
      
      try {
        var response = await fetch('/api/login/2fa', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ twofa_token: pending2FAToken, code: code })
        });
        
        var data = await response.json();
        
        if (data.success) {
          completeLogin(data);
        } else {
          err.textContent = data.error || 'Verification failed. Please try again.';
        }
      } catch (e) {
        console.error('2FA verification error:', e);
        err.textContent = 'Connection error. Please try again.';
      }
      
      btn.disabled = false;
      btn.textContent = 'Verify';
      return false;
    }
    
    async function requestPasswordReset(event) {
      if (event) event.preventDefault();
      var email = document.getElementById('resetEmail').value.toLowerCase().trim();
      var err = document.getElementById('loginError');
      var success = document.getElementById('loginSuccess');
      var btn = document.getElementById('resetPasswordBtn');
      
      if (!email) {
        err.textContent = 'Please enter your email address.';
        return false;
      }
      
      btn.disabled = true;
      btn.textContent = 'Sending...';
      err.textContent = '';
      success.textContent = '';
      success.classList.add('hidden');
      
      try {
        var response = await fetch('/api/request-password-reset', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: email })
        });
        
        var data = await response.json();
        
        if (data.success) {
          success.textContent = data.message;
          success.classList.remove('hidden');
          setTimeout(function() {
            showLoginForm();
          }, 5000);
        } else {
          err.textContent = data.error || 'Request failed. Please try again.';
        }
      } catch (e) {
        console.error('Password reset request error:', e);
        err.textContent = 'Connection error. Please try again.';
      }
      
      btn.disabled = false;
      btn.textContent = 'Send Reset Link';
      return false;
    }
    
    async function completePasswordReset(event) {
      if (event) event.preventDefault();
      var newPass = document.getElementById('newResetPassword').value;
      var confirmPass = document.getElementById('confirmResetPassword').value;
      var err = document.getElementById('loginError');
      var success = document.getElementById('loginSuccess');
      var btn = document.getElementById('completeResetBtn');
      
      if (!newPass || newPass.length < 6) {
        err.textContent = 'Password must be at least 6 characters.';
        return false;
      }
      
      if (newPass !== confirmPass) {
        err.textContent = 'Passwords do not match.';
        return false;
      }
      
      btn.disabled = true;
      btn.textContent = 'Saving...';
      err.textContent = '';
      
      try {
        var urlParams = new URLSearchParams(window.location.search);
        var resetToken = urlParams.get('reset_token');
        
        var response = await fetch('/api/complete-password-reset', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ reset_token: resetToken, new_password: newPass })
        });
        
        var data = await response.json();
        
        if (data.success) {
          success.textContent = data.message;
          success.classList.remove('hidden');
          window.history.replaceState({}, document.title, window.location.pathname);
          setTimeout(function() {
            showLoginForm();
          }, 3000);
        } else {
          err.textContent = data.error || 'Password reset failed. Please try again.';
        }
      } catch (e) {
        console.error('Password reset completion error:', e);
        err.textContent = 'Connection error. Please try again.';
      }
      
      btn.disabled = false;
      btn.textContent = 'Set New Password';
      return false;
    }
    
    function showLoginForm() {
      document.getElementById('loginForm').classList.remove('hidden');
      document.getElementById('twoFAForm').classList.add('hidden');
      document.getElementById('forgotPasswordForm').classList.add('hidden');
      document.getElementById('completeResetForm').classList.add('hidden');
      document.getElementById('forgotPasswordLink').classList.remove('hidden');
      document.getElementById('loginError').textContent = '';
      document.getElementById('loginSuccess').textContent = '';
      document.getElementById('loginSuccess').classList.add('hidden');
      pending2FAToken = null;
      pending2FAEmail = null;
    }
    
    function showForgotPasswordForm() {
      document.getElementById('loginForm').classList.add('hidden');
      document.getElementById('twoFAForm').classList.add('hidden');
      document.getElementById('forgotPasswordForm').classList.remove('hidden');
      document.getElementById('completeResetForm').classList.add('hidden');
      document.getElementById('forgotPasswordLink').classList.add('hidden');
      document.getElementById('loginError').textContent = '';
      document.getElementById('loginSuccess').textContent = '';
      document.getElementById('loginSuccess').classList.add('hidden');
      document.getElementById('resetEmail').focus();
    }
    
    function checkForResetToken() {
      var urlParams = new URLSearchParams(window.location.search);
      var resetToken = urlParams.get('reset_token');
      if (resetToken) {
        document.getElementById('loginForm').classList.add('hidden');
        document.getElementById('completeResetForm').classList.remove('hidden');
        document.getElementById('forgotPasswordLink').classList.add('hidden');
        document.getElementById('newResetPassword').focus();
      }
    }
    
    document.addEventListener('DOMContentLoaded', function() {
      var forgotLink = document.getElementById('forgotPasswordLink');
      if (forgotLink) {
        forgotLink.onclick = function(e) {
          e.preventDefault();
          showForgotPasswordForm();
        };
      }
      
      var cancelResetLink = document.getElementById('cancelResetLink');
      if (cancelResetLink) {
        cancelResetLink.onclick = function(e) {
          e.preventDefault();
          showLoginForm();
        };
      }
      
      var cancel2FALink = document.getElementById('cancel2FALink');
      if (cancel2FALink) {
        cancel2FALink.onclick = function(e) {
          e.preventDefault();
          showLoginForm();
        };
      }
      
      checkForResetToken();
    });
    
    async function checkExistingSession() {
      var token = localStorage.getItem('ftg_session_token');
      if (!token) return;
      
      try {
        var response = await fetch('/api/verify-session', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        var data = await response.json();
        
        if (data.success && data.user) {
          document.getElementById('loginScreen').classList.add('hidden');
          var userLabel = document.getElementById('currentUser');
          if (userLabel) userLabel.textContent = data.user.displayName;
          
          // Check admin access after restoring session
          if (typeof checkAdminAccess === 'function') {
            setTimeout(function() { checkAdminAccess(); }, 500);
          }
        } else {
          localStorage.removeItem('ftg_session_token');
          localStorage.removeItem('ftg_authenticated');
        }
      } catch (e) {
        console.error('Session check error:', e);
      }
    }
    
    if (localStorage.getItem('ftg_session_token')) {
      checkExistingSession();
    }
    
    document.getElementById('forgotPasswordLink').onclick = function(e) {
      e.preventDefault();
      var email = document.getElementById('loginUsername').value.toLowerCase().trim();
      var err = document.getElementById('loginError');
      
      if (!email) {
        err.textContent = 'Please enter your email address first.';
        return;
      }
      
      var resetCode = prompt('Enter admin reset code to reset password to default:');
      if (resetCode === 'FTG2025Reset') {
        err.style.color = '#166534';
        err.textContent = 'Please contact your administrator to reset your password.';
      } else if (resetCode) {
        err.textContent = 'Invalid reset code. Contact administrator.';
      }
    };
  </script>

  <!-- HEADER -->
  <header class="header">
    <button id="mobileMenuButton" class="mobile-menu-btn">‚ò∞</button>

    <div class="header-left">
      <!-- YOUR LOGO HERE -->
      <img src="logo.png" alt="FTG Logo" class="header-logo">
      <h1 class="logo">FTG Dashboard</h1>
    </div>

    <div class="header-right">
      <!-- Dark Mode Toggle -->
      <button id="darkModeToggle" class="dark-mode-toggle" title="Toggle dark mode">
        <span class="dark-mode-icon-light">‚òÄÔ∏è</span>
        <span class="dark-mode-icon-dark">üåô</span>
      </button>
      
      <!-- User Menu Dropdown -->
      <div class="user-dropdown">
        <button id="userDropdownBtn" class="user-dropdown-btn">
          <span id="currentUser" class="user-label"></span>
          <span class="user-dropdown-arrow">‚ñº</span>
        </button>
        <div id="userDropdownMenu" class="dropdown-menu hidden">
          <div class="dropdown-item theme-selector">
            <span>üé® Theme</span>
            <select id="themeSelect" onclick="event.stopPropagation()">
              <option value="light">Light</option>
              <option value="dark">Dark</option>
            </select>
          </div>
          <div id="myPmViewToggleContainer" class="dropdown-item pm-view-toggle hidden" onclick="event.stopPropagation()">
            <span>üë§ My PM View</span>
            <label class="toggle-switch small">
              <input type="checkbox" id="myPmViewToggle">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <button id="changePasswordBtn" class="dropdown-item">üîë Change Password</button>
          <button id="securitySettingsBtn" class="dropdown-item">üîê Security Settings</button>
          <button id="logoutBtn" class="dropdown-item">üö™ Logout</button>
        </div>
      </div>
    </div>
  </header>

  <div class="layout">

    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <img src="logo.png" alt="FTG Logo">
        <span>FTG Dashboard</span>
      </div>
      <nav>
        <ul>
          <li class="nav-item nav-parent expanded" id="navFinancialStatements">
            <span class="nav-parent-label">Financials</span>
            <span class="nav-expand-icon">‚ñº</span>
          </li>
          <ul class="nav-children expanded" id="navFinancialStatementsChildren">
            <li class="nav-item nav-child" data-section="overview">Overview</li>
            <li class="nav-item nav-child" data-section="revenue">Revenue</li>
            <li class="nav-item nav-child" data-section="incomeStatement">Income Statement</li>
            <li class="nav-item nav-child" data-section="balanceSheet">Balance Sheet</li>
            <li class="nav-item nav-child" data-section="cashFlows">Statement of Cash Flows</li>
            <li class="nav-item nav-child" data-section="cashReports">Cash Balances</li>
            <li class="nav-item nav-child" data-section="accounts">Account Detail</li>
            <li class="nav-item nav-child" data-section="payments">Payments</li>
            <li class="nav-item nav-child placeholder" data-section="receivablesPayables">Receivables/Payables</li>
          </ul>
          <li class="nav-item nav-parent expanded" id="navJobs">
            <span class="nav-parent-label">Jobs</span>
            <span class="nav-expand-icon">‚ñº</span>
          </li>
          <ul class="nav-children expanded" id="navJobsChildren">
            <li class="nav-item nav-child" data-section="jobOverview">Overview</li>
            <li class="nav-item nav-child" data-section="jobBudgets">Budgets</li>
            <li class="nav-item nav-child" data-section="jobActuals">Actuals</li>
            <li class="nav-item nav-child" data-section="costCodes">Cost Codes</li>
            <li class="nav-item nav-child" data-section="missingBudgets">Missing Budgets</li>
            <li class="nav-item nav-child placeholder" data-section="jobAnalytics">Job Analytics</li>
                      </ul>
          <li class="nav-item admin-nav-item hidden" data-section="admin" id="adminNavItem">Admin</li>
        </ul>
      </nav>
    </aside>

    <div id="overlay" class="overlay hidden"></div>

    <!-- MAIN CONTENT -->
    <main class="content">
      <!-- Export Ribbon (Desktop) / Dropdown (Mobile) -->
      <div class="content-export-area">
        <!-- Desktop Ribbon -->
        <div class="export-ribbon">
          <button id="exportPrintBtnRibbon" class="ribbon-btn" title="Print">
            <span class="ribbon-icon">üñ®Ô∏è</span>
            <span class="ribbon-label">Print</span>
          </button>
          <button id="exportPdfBtnRibbon" class="ribbon-btn" title="PDF">
            <span class="ribbon-icon">üìÑ</span>
            <span class="ribbon-label">PDF</span>
          </button>
          <button id="exportCsvBtnRibbon" class="ribbon-btn" title="CSV">
            <span class="ribbon-icon">üìä</span>
            <span class="ribbon-label">CSV</span>
          </button>
          <button id="exportExcelBtnRibbon" class="ribbon-btn" title="Excel">
            <span class="ribbon-icon">üìó</span>
            <span class="ribbon-label">Excel</span>
          </button>
          <button id="exportEmailBtnRibbon" class="ribbon-btn" title="Email">
            <span class="ribbon-icon">üìß</span>
            <span class="ribbon-label">Email</span>
          </button>
          <button id="scheduleEmailBtnRibbon" class="ribbon-btn" title="Schedule">
            <span class="ribbon-icon">üìÖ</span>
            <span class="ribbon-label">Schedule</span>
          </button>
        </div>
        <!-- Mobile Dropdown -->
        <div class="export-dropdown mobile-only">
          <button id="exportDropdownBtn" class="export-dropdown-btn" title="Export options">‚¨áÔ∏è</button>
          <div id="exportDropdownMenu" class="dropdown-menu hidden">
            <button id="exportPrintBtn" class="dropdown-item">üñ®Ô∏è Print</button>
            <button id="exportPdfBtn" class="dropdown-item">üìÑ PDF</button>
            <button id="exportCsvBtn" class="dropdown-item">üìä CSV</button>
            <button id="exportExcelBtn" class="dropdown-item">üìó Excel</button>
            <button id="exportEmailBtn" class="dropdown-item">üìß Email</button>
            <button id="scheduleEmailBtn" class="dropdown-item">üìÖ Schedule Email</button>
          </div>
        </div>
      </div>

      <!-- OVERVIEW SECTION -->
      <section id="overview" class="dashboard-section">
        <h2>Financial Overview</h2>
        <div class="data-as-of">Data as of: <span id="overviewDataAsOf"></span></div>

        <div class="config-panel">
          <div class="config-header collapsed" data-target="overviewConfigBody">
            <span class="config-toggle">‚ñº</span>
            <span class="config-title">Configuration Options</span>
            <button class="config-expand-btn">Expand ‚ñº</button>
          </div>
          <div class="config-body collapsed" id="overviewConfigBody">
            <div class="saved-views-row">
              <select id="overviewSavedViews" class="saved-views-select">
                <option value="">-- Current Settings --</option>
              </select>
              <button type="button" id="overviewSaveViewBtn" class="save-view-btn">Save View</button>
              <button type="button" id="overviewDeleteViewBtn" class="delete-view-btn" title="Delete selected view"<svg viewBox="0 0 16 16" width="12" height="12"><path fill="currentColor" d="M2.5 1L8 6.5 13.5 1 15 2.5 9.5 8 15 13.5 13.5 15 8 9.5 2.5 15 1 13.5 6.5 8 1 2.5 2.5 1z"/></svg></button>
            </div>
            <div class="rev-controls">
              <div class="overview-config-box">
                <div style="font-weight: 600; margin-bottom: 8px; color: #374151;">Time Period:</div>
                <div class="dropdown-stack">
                  <div class="dropdown-row">
                    <label>View:</label>
                    <select id="overviewViewType">
                      <option value="monthly">Monthly</option>
                      <option value="quarterly" selected>Quarterly</option>
                      <option value="annual">Annual</option>
                    </select>
                  </div>
                  <div class="dropdown-row" id="overviewYearWrapper">
                    <label>Year:</label>
                    <select id="overviewYear"></select>
                  </div>
                </div>
              </div>

              <div class="overview-config-box">
                <div style="font-weight: 600; margin-bottom: 8px; color: #374151;">Visuals:</div>
                <div class="checkbox-stack">
                  <label class="checkbox-label">
                    <input type="checkbox" id="overviewCompare">
                    Compare to Prior Year
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="overviewTrend" checked>
                    Show Trendline
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="overviewDataLabels">
                    Show Data Labels
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="overviewExclude" checked>
                    Exclude Month in Progress
                  </label>
                </div>
              </div>

              <div class="overview-config-box">
                <label class="section-label" style="font-weight: 600;">Show Metrics:</label>
                <div class="metric-checkboxes">
                  <label class="checkbox-label">
                    <input type="checkbox" id="showRevenue" checked data-metric="revenue">
                    Revenue
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="showGrossProfit" checked data-metric="grossProfit">
                    Gross Profit
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="showGrossMargin" checked data-metric="grossMargin">
                    Gross Profit %
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="showOpExpenses" checked data-metric="opExpenses">
                    Operating Expenses
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="showOpProfit" checked data-metric="opProfit">
                    Operating Profit
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="showOpMargin" checked data-metric="opMargin">
                    Operating Profit %
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="showCash" checked data-metric="cash">
                    Cash
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="showReceivables" checked data-metric="receivables">
                    Receivables
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="showPayables" checked data-metric="payables">
                    Payables
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="showCurrentRatio" checked data-metric="currentRatio">
                    Current Ratio
                  </label>
                </div>
              </div>

              <div id="overviewRangeWrapper" class="range-wrapper hidden">
                <label>Select Range:</label>
                <div class="range-container">
                  <input type="range" id="overviewRangeStart" min="2015" max="2025" value="2018" step="1">
                  <input type="range" id="overviewRangeEnd" min="2015" max="2025" value="2025" step="1">
                </div>
                <div class="range-labels">
                  <span id="overviewRangeStartLabel">2018</span>
                  <span id="overviewRangeEndLabel">2025</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="overviewAiAnalysisPanel" class="ai-analysis-panel">
          <div class="ai-analysis-header" id="overviewAiAnalysisHeader">
            <div class="ai-analysis-header-left">
              <span class="ai-analysis-toggle-icon">‚ñº</span>
              <span class="ai-analysis-title">AI ANALYSIS</span>
              <button type="button" id="overviewAiAnalyzeBtn" class="ai-run-btn">Run Analysis</button>
            </div>
          </div>
          <div id="overviewAiAnalysisBody" class="ai-analysis-body">
            <div id="overviewAiAnalysisContent" class="ai-analysis-content"></div>
          </div>
        </div>

        <div class="overview-tiles-grid">
          <div class="overview-metric-tile">
            <div class="metric-tile-header">
              <div class="metric-tile-title-wrapper">
                <span class="metric-tile-title" title="Total income from sales and services before any deductions">Revenue</span>
                <button class="metric-info-btn" data-info="Total income from sales and services before any deductions" aria-label="Info about Revenue">‚ìò</button>
              </div>
              <div class="metric-tile-buttons">
                <button class="chart-expand-btn" data-chart="overviewRevenueChart" data-title="Revenue" title="Expand chart"><svg viewBox="0 0 16 16" width="10" height="10"><path fill="currentColor" d="M2 2h5V0H0v7h2V2zm12 0h-5V0h7v7h-2V2zM2 14h5v2H0V9h2v5zm12 0h-5v2h7V9h-2v5z"/></svg></button>
                <button class="chart-close-btn" data-metric="showRevenue" title="Hide this metric"><svg viewBox="0 0 16 16" width="12" height="12"><path fill="currentColor" d="M2.5 1L8 6.5 13.5 1 15 2.5 9.5 8 15 13.5 13.5 15 8 9.5 2.5 15 1 13.5 6.5 8 1 2.5 2.5 1z"/></svg></button>
              </div>
            </div>
            <canvas id="overviewRevenueChart"></canvas>
            <div class="metric-stats" id="overviewRevenueStats">
              <div class="stat-box"><div class="stat-label">Average</div><div class="stat-value" id="revenueAvg">-</div></div>
              <div class="stat-box"><div class="stat-label">Highest</div><div class="stat-value" id="revenueHigh">-</div><div class="stat-period" id="revenueHighPeriod"></div></div>
              <div class="stat-box"><div class="stat-label">Lowest</div><div class="stat-value" id="revenueLow">-</div><div class="stat-period" id="revenueLowPeriod"></div></div>
              <div class="stat-box"><div class="stat-label" id="revenueGrowthLabel">CAGR</div><div class="stat-value" id="revenueCagr">-</div></div>
            </div>
          </div>
          <div class="overview-metric-tile">
            <div class="metric-tile-header">
              <div class="metric-tile-title-wrapper">
                <span class="metric-tile-title" title="Revenue minus cost of goods sold (direct costs of construction)">Gross Profit</span>
                <button class="metric-info-btn" data-info="Revenue minus cost of goods sold (direct costs of construction)" aria-label="Info about Gross Profit">‚ìò</button>
              </div>
              <div class="metric-tile-buttons">
                <button class="chart-expand-btn" data-chart="overviewGrossProfitChart" data-title="Gross Profit" title="Expand chart"><svg viewBox="0 0 16 16" width="10" height="10"><path fill="currentColor" d="M2 2h5V0H0v7h2V2zm12 0h-5V0h7v7h-2V2zM2 14h5v2H0V9h2v5zm12 0h-5v2h7V9h-2v5z"/></svg></button>
                <button class="chart-close-btn" data-metric="showGrossProfit" title="Hide this metric"><svg viewBox="0 0 16 16" width="12" height="12"><path fill="currentColor" d="M2.5 1L8 6.5 13.5 1 15 2.5 9.5 8 15 13.5 13.5 15 8 9.5 2.5 15 1 13.5 6.5 8 1 2.5 2.5 1z"/></svg></button>
              </div>
            </div>
            <canvas id="overviewGrossProfitChart"></canvas>
            <div class="metric-stats" id="overviewGrossProfitStats">
              <div class="stat-box"><div class="stat-label">Average</div><div class="stat-value" id="grossProfitAvg">-</div></div>
              <div class="stat-box"><div class="stat-label">Highest</div><div class="stat-value" id="grossProfitHigh">-</div><div class="stat-period" id="grossProfitHighPeriod"></div></div>
              <div class="stat-box"><div class="stat-label">Lowest</div><div class="stat-value" id="grossProfitLow">-</div><div class="stat-period" id="grossProfitLowPeriod"></div></div>
              <div class="stat-box"><div class="stat-label" id="grossProfitGrowthLabel">CAGR</div><div class="stat-value" id="grossProfitCagr">-</div></div>
            </div>
          </div>
          <div class="overview-metric-tile">
            <div class="metric-tile-header">
              <div class="metric-tile-title-wrapper">
                <span class="metric-tile-title" title="Gross Profit as a percentage of Revenue - measures production efficiency">Gross Profit Margin %</span>
                <button class="metric-info-btn" data-info="Gross Profit as a percentage of Revenue - measures production efficiency" aria-label="Info about Gross Profit Margin">‚ìò</button>
              </div>
              <div class="metric-tile-buttons">
                <button class="chart-expand-btn" data-chart="overviewGrossMarginChart" data-title="Gross Profit Margin %" title="Expand chart"><svg viewBox="0 0 16 16" width="10" height="10"><path fill="currentColor" d="M2 2h5V0H0v7h2V2zm12 0h-5V0h7v7h-2V2zM2 14h5v2H0V9h2v5zm12 0h-5v2h7V9h-2v5z"/></svg></button>
                <button class="chart-close-btn" data-metric="showGrossMargin" title="Hide this metric"><svg viewBox="0 0 16 16" width="12" height="12"><path fill="currentColor" d="M2.5 1L8 6.5 13.5 1 15 2.5 9.5 8 15 13.5 13.5 15 8 9.5 2.5 15 1 13.5 6.5 8 1 2.5 2.5 1z"/></svg></button>
              </div>
            </div>
            <canvas id="overviewGrossMarginChart"></canvas>
            <div class="metric-stats" id="overviewGrossMarginStats">
              <div class="stat-box"><div class="stat-label">Average</div><div class="stat-value" id="grossMarginAvg">-</div></div>
              <div class="stat-box"><div class="stat-label">Highest</div><div class="stat-value" id="grossMarginHigh">-</div><div class="stat-period" id="grossMarginHighPeriod"></div></div>
              <div class="stat-box"><div class="stat-label">Lowest</div><div class="stat-value" id="grossMarginLow">-</div><div class="stat-period" id="grossMarginLowPeriod"></div></div>
              <div class="stat-box"><div class="stat-label" id="grossMarginGrowthLabel">CAGR</div><div class="stat-value" id="grossMarginCagr">-</div></div>
            </div>
          </div>
          <div class="overview-metric-tile">
            <div class="metric-tile-header">
              <div class="metric-tile-title-wrapper">
                <span class="metric-tile-title" title="Overhead costs like salaries, rent, utilities, and administrative expenses">Operating Expenses</span>
                <button class="metric-info-btn" data-info="Overhead costs like salaries, rent, utilities, and administrative expenses" aria-label="Info about Operating Expenses">‚ìò</button>
              </div>
              <div class="metric-tile-buttons">
                <button class="chart-expand-btn" data-chart="overviewOpexChart" data-title="Operating Expenses" title="Expand chart"><svg viewBox="0 0 16 16" width="10" height="10"><path fill="currentColor" d="M2 2h5V0H0v7h2V2zm12 0h-5V0h7v7h-2V2zM2 14h5v2H0V9h2v5zm12 0h-5v2h7V9h-2v5z"/></svg></button>
                <button class="chart-close-btn" data-metric="showOpExpenses" title="Hide this metric"><svg viewBox="0 0 16 16" width="12" height="12"><path fill="currentColor" d="M2.5 1L8 6.5 13.5 1 15 2.5 9.5 8 15 13.5 13.5 15 8 9.5 2.5 15 1 13.5 6.5 8 1 2.5 2.5 1z"/></svg></button>
              </div>
            </div>
            <canvas id="overviewOpexChart"></canvas>
            <div class="metric-stats" id="overviewOpexStats">
              <div class="stat-box"><div class="stat-label">Average</div><div class="stat-value" id="opexAvg">-</div></div>
              <div class="stat-box"><div class="stat-label">Highest</div><div class="stat-value" id="opexHigh">-</div><div class="stat-period" id="opexHighPeriod"></div></div>
              <div class="stat-box"><div class="stat-label">Lowest</div><div class="stat-value" id="opexLow">-</div><div class="stat-period" id="opexLowPeriod"></div></div>
              <div class="stat-box"><div class="stat-label" id="opexGrowthLabel">CAGR</div><div class="stat-value" id="opexCagr">-</div></div>
            </div>
          </div>
          <div class="overview-metric-tile">
            <div class="metric-tile-header">
              <div class="metric-tile-title-wrapper">
                <span class="metric-tile-title" title="Gross Profit minus Operating Expenses - profit from core business operations">Operating Profit</span>
                <button class="metric-info-btn" data-info="Gross Profit minus Operating Expenses - profit from core business operations" aria-label="Info about Operating Profit">‚ìò</button>
              </div>
              <div class="metric-tile-buttons">
                <button class="chart-expand-btn" data-chart="overviewOpProfitChart" data-title="Operating Profit" title="Expand chart"><svg viewBox="0 0 16 16" width="10" height="10"><path fill="currentColor" d="M2 2h5V0H0v7h2V2zm12 0h-5V0h7v7h-2V2zM2 14h5v2H0V9h2v5zm12 0h-5v2h7V9h-2v5z"/></svg></button>
                <button class="chart-close-btn" data-metric="showOpProfit" title="Hide this metric"><svg viewBox="0 0 16 16" width="12" height="12"><path fill="currentColor" d="M2.5 1L8 6.5 13.5 1 15 2.5 9.5 8 15 13.5 13.5 15 8 9.5 2.5 15 1 13.5 6.5 8 1 2.5 2.5 1z"/></svg></button>
              </div>
            </div>
            <canvas id="overviewOpProfitChart"></canvas>
            <div class="metric-stats" id="overviewOpProfitStats">
              <div class="stat-box"><div class="stat-label">Average</div><div class="stat-value" id="opProfitAvg">-</div></div>
              <div class="stat-box"><div class="stat-label">Highest</div><div class="stat-value" id="opProfitHigh">-</div><div class="stat-period" id="opProfitHighPeriod"></div></div>
              <div class="stat-box"><div class="stat-label">Lowest</div><div class="stat-value" id="opProfitLow">-</div><div class="stat-period" id="opProfitLowPeriod"></div></div>
              <div class="stat-box"><div class="stat-label" id="opProfitGrowthLabel">CAGR</div><div class="stat-value" id="opProfitCagr">-</div></div>
            </div>
          </div>
          <div class="overview-metric-tile">
            <div class="metric-tile-header">
              <div class="metric-tile-title-wrapper">
                <span class="metric-tile-title" title="Operating Profit as a percentage of Revenue - measures overall operational efficiency">Operating Profit %</span>
                <button class="metric-info-btn" data-info="Operating Profit as a percentage of Revenue - measures overall operational efficiency" aria-label="Info about Operating Profit %">‚ìò</button>
              </div>
              <div class="metric-tile-buttons">
                <button class="chart-expand-btn" data-chart="overviewOpMarginChart" data-title="Operating Profit %" title="Expand chart"><svg viewBox="0 0 16 16" width="10" height="10"><path fill="currentColor" d="M2 2h5V0H0v7h2V2zm12 0h-5V0h7v7h-2V2zM2 14h5v2H0V9h2v5zm12 0h-5v2h7V9h-2v5z"/></svg></button>
                <button class="chart-close-btn" data-metric="showOpMargin" title="Hide this metric"><svg viewBox="0 0 16 16" width="12" height="12"><path fill="currentColor" d="M2.5 1L8 6.5 13.5 1 15 2.5 9.5 8 15 13.5 13.5 15 8 9.5 2.5 15 1 13.5 6.5 8 1 2.5 2.5 1z"/></svg></button>
              </div>
            </div>
            <canvas id="overviewOpMarginChart"></canvas>
            <div class="metric-stats" id="overviewOpMarginStats">
              <div class="stat-box"><div class="stat-label">Average</div><div class="stat-value" id="opMarginAvg">-</div></div>
              <div class="stat-box"><div class="stat-label">Highest</div><div class="stat-value" id="opMarginHigh">-</div><div class="stat-period" id="opMarginHighPeriod"></div></div>
              <div class="stat-box"><div class="stat-label">Lowest</div><div class="stat-value" id="opMarginLow">-</div><div class="stat-period" id="opMarginLowPeriod"></div></div>
              <div class="stat-box"><div class="stat-label" id="opMarginGrowthLabel">CAGR</div><div class="stat-value" id="opMarginCagr">-</div></div>
            </div>
          </div>
          <div class="overview-metric-tile">
            <div class="metric-tile-header">
              <div class="metric-tile-title-wrapper">
                <span class="metric-tile-title" title="Total cash and cash equivalents including checking, savings, and undeposited funds">Cash</span>
                <button class="metric-info-btn" data-info="Total cash and cash equivalents including checking, savings, and undeposited funds" aria-label="Info about Cash">‚ìò</button>
              </div>
              <div class="metric-tile-buttons">
                <button class="chart-expand-btn" data-chart="overviewCashChart" data-title="Cash" title="Expand chart"><svg viewBox="0 0 16 16" width="10" height="10"><path fill="currentColor" d="M2 2h5V0H0v7h2V2zm12 0h-5V0h7v7h-2V2zM2 14h5v2H0V9h2v5zm12 0h-5v2h7V9h-2v5z"/></svg></button>
                <button class="chart-close-btn" data-metric="showCash" title="Hide this metric"><svg viewBox="0 0 16 16" width="12" height="12"><path fill="currentColor" d="M2.5 1L8 6.5 13.5 1 15 2.5 9.5 8 15 13.5 13.5 15 8 9.5 2.5 15 1 13.5 6.5 8 1 2.5 2.5 1z"/></svg></button>
              </div>
            </div>
            <canvas id="overviewCashChart"></canvas>
            <div class="metric-stats" id="overviewCashStats">
              <div class="stat-box"><div class="stat-label">Average</div><div class="stat-value" id="cashAvg">-</div></div>
              <div class="stat-box"><div class="stat-label">Highest</div><div class="stat-value" id="cashHigh">-</div><div class="stat-period" id="cashHighPeriod"></div></div>
              <div class="stat-box"><div class="stat-label">Lowest</div><div class="stat-value" id="cashLow">-</div><div class="stat-period" id="cashLowPeriod"></div></div>
              <div class="stat-box"><div class="stat-label" id="cashGrowthLabel">CAGR</div><div class="stat-value" id="cashCagr">-</div></div>
            </div>
          </div>
          <div class="overview-metric-tile">
            <div class="metric-tile-header">
              <div class="metric-tile-title-wrapper">
                <span class="metric-tile-title" title="Money owed to the company by customers for completed work">Receivables</span>
                <button class="metric-info-btn" data-info="Money owed to the company by customers for completed work" aria-label="Info about Receivables">‚ìò</button>
              </div>
              <div class="metric-tile-buttons">
                <button class="chart-expand-btn" data-chart="overviewReceivablesChart" data-title="Receivables" title="Expand chart"><svg viewBox="0 0 16 16" width="10" height="10"><path fill="currentColor" d="M2 2h5V0H0v7h2V2zm12 0h-5V0h7v7h-2V2zM2 14h5v2H0V9h2v5zm12 0h-5v2h7V9h-2v5z"/></svg></button>
                <button class="chart-close-btn" data-metric="showReceivables" title="Hide this metric"><svg viewBox="0 0 16 16" width="12" height="12"><path fill="currentColor" d="M2.5 1L8 6.5 13.5 1 15 2.5 9.5 8 15 13.5 13.5 15 8 9.5 2.5 15 1 13.5 6.5 8 1 2.5 2.5 1z"/></svg></button>
              </div>
            </div>
            <canvas id="overviewReceivablesChart"></canvas>
            <div class="metric-stats" id="overviewReceivablesStats">
              <div class="stat-box"><div class="stat-label">Average</div><div class="stat-value" id="receivablesAvg">-</div></div>
              <div class="stat-box"><div class="stat-label">Highest</div><div class="stat-value" id="receivablesHigh">-</div><div class="stat-period" id="receivablesHighPeriod"></div></div>
              <div class="stat-box"><div class="stat-label">Lowest</div><div class="stat-value" id="receivablesLow">-</div><div class="stat-period" id="receivablesLowPeriod"></div></div>
              <div class="stat-box"><div class="stat-label" id="receivablesGrowthLabel">CAGR</div><div class="stat-value" id="receivablesCagr">-</div></div>
            </div>
          </div>
          <div class="overview-metric-tile">
            <div class="metric-tile-header">
              <div class="metric-tile-title-wrapper">
                <span class="metric-tile-title" title="Money the company owes to vendors and suppliers">Accounts Payable</span>
                <button class="metric-info-btn" data-info="Money the company owes to vendors and suppliers" aria-label="Info about Accounts Payable">‚ìò</button>
              </div>
              <div class="metric-tile-buttons">
                <button class="chart-expand-btn" data-chart="overviewPayablesChart" data-title="Accounts Payable" title="Expand chart"><svg viewBox="0 0 16 16" width="10" height="10"><path fill="currentColor" d="M2 2h5V0H0v7h2V2zm12 0h-5V0h7v7h-2V2zM2 14h5v2H0V9h2v5zm12 0h-5v2h7V9h-2v5z"/></svg></button>
                <button class="chart-close-btn" data-metric="showPayables" title="Hide this metric"><svg viewBox="0 0 16 16" width="12" height="12"><path fill="currentColor" d="M2.5 1L8 6.5 13.5 1 15 2.5 9.5 8 15 13.5 13.5 15 8 9.5 2.5 15 1 13.5 6.5 8 1 2.5 2.5 1z"/></svg></button>
              </div>
            </div>
            <canvas id="overviewPayablesChart"></canvas>
            <div class="metric-stats" id="overviewPayablesStats">
              <div class="stat-box"><div class="stat-label">Average</div><div class="stat-value" id="payablesAvg">-</div></div>
              <div class="stat-box"><div class="stat-label">Highest</div><div class="stat-value" id="payablesHigh">-</div><div class="stat-period" id="payablesHighPeriod"></div></div>
              <div class="stat-box"><div class="stat-label">Lowest</div><div class="stat-value" id="payablesLow">-</div><div class="stat-period" id="payablesLowPeriod"></div></div>
              <div class="stat-box"><div class="stat-label" id="payablesGrowthLabel">CAGR</div><div class="stat-value" id="payablesCagr">-</div></div>
            </div>
          </div>
          <div class="overview-metric-tile">
            <div class="metric-tile-header">
              <div class="metric-tile-title-wrapper">
                <span class="metric-tile-title" title="Current Assets divided by Current Liabilities - measures ability to pay short-term obligations. Above 1.0 is healthy.">Current Ratio</span>
                <button class="metric-info-btn" data-info="Current Assets divided by Current Liabilities - measures ability to pay short-term obligations. Above 1.0 is healthy." aria-label="Info about Current Ratio">‚ìò</button>
              </div>
              <div class="metric-tile-buttons">
                <button class="chart-expand-btn" data-chart="overviewCurrentRatioChart" data-title="Current Ratio" title="Expand chart"><svg viewBox="0 0 16 16" width="10" height="10"><path fill="currentColor" d="M2 2h5V0H0v7h2V2zm12 0h-5V0h7v7h-2V2zM2 14h5v2H0V9h2v5zm12 0h-5v2h7V9h-2v5z"/></svg></button>
                <button class="chart-close-btn" data-metric="showCurrentRatio" title="Hide this metric"><svg viewBox="0 0 16 16" width="12" height="12"><path fill="currentColor" d="M2.5 1L8 6.5 13.5 1 15 2.5 9.5 8 15 13.5 13.5 15 8 9.5 2.5 15 1 13.5 6.5 8 1 2.5 2.5 1z"/></svg></button>
              </div>
            </div>
            <canvas id="overviewCurrentRatioChart"></canvas>
            <div class="metric-stats" id="overviewCurrentRatioStats">
              <div class="stat-box"><div class="stat-label">Average</div><div class="stat-value" id="currentRatioAvg">-</div></div>
              <div class="stat-box"><div class="stat-label">Highest</div><div class="stat-value" id="currentRatioHigh">-</div><div class="stat-period" id="currentRatioHighPeriod"></div></div>
              <div class="stat-box"><div class="stat-label">Lowest</div><div class="stat-value" id="currentRatioLow">-</div><div class="stat-period" id="currentRatioLowPeriod"></div></div>
              <div class="stat-box"><div class="stat-label" id="currentRatioGrowthLabel">CAGR</div><div class="stat-value" id="currentRatioCagr">-</div></div>
            </div>
          </div>
        </div>
      </section>

      <!-- ============================================================
           REVENUE VIEW
      ============================================================= -->
      <section id="revenue" class="dashboard-section">
        <h2>Revenue</h2>
        <div class="data-as-of">Data as of: <span id="revDataAsOf"></span></div>

        <div class="config-panel">
          <div class="config-header collapsed" data-target="revConfigBody">
            <span class="config-toggle">‚ñº</span>
            <span class="config-title">Configuration Options</span>
            <button class="config-expand-btn">Expand ‚ñº</button>
          </div>
          <div class="config-body collapsed" id="revConfigBody">
            <div class="saved-views-row">
              <select id="revSavedViews" class="saved-views-select">
                <option value="">-- Current Settings --</option>
              </select>
              <button type="button" id="revSaveViewBtn" class="save-view-btn">Save View</button>
              <button type="button" id="revDeleteViewBtn" class="delete-view-btn" title="Delete selected view"<svg viewBox="0 0 16 16" width="12" height="12"><path fill="currentColor" d="M2.5 1L8 6.5 13.5 1 15 2.5 9.5 8 15 13.5 13.5 15 8 9.5 2.5 15 1 13.5 6.5 8 1 2.5 2.5 1z"/></svg></button>
            </div>
            <div class="rev-controls">
              <div class="overview-config-box">
                <div style="font-weight: 600; margin-bottom: 8px; color: #374151;">Time Period:</div>
                <div class="dropdown-stack">
                  <div class="dropdown-row">
                    <label>View:</label>
                    <select id="revViewType">
                      <option value="monthly">Monthly</option>
                      <option value="quarterly">Quarterly</option>
                      <option value="annual">Annual</option>
                    </select>
                  </div>
                  <div class="dropdown-row" id="revYearWrapper">
                    <label>Year:</label>
                    <select id="revYear"></select>
                  </div>
                </div>
              </div>

              <div class="overview-config-box">
                <div style="font-weight: 600; margin-bottom: 8px; color: #374151;">Visuals:</div>
                <div class="checkbox-stack">
                  <label class="checkbox-label">
                    <input type="checkbox" id="revCompare">
                    Compare to Prior Year
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="revTrendline">
                    Show Trendline
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="revDataLabels">
                    Show Data Labels
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="revExcludeCurrent" checked>
                    <span id="revExcludeLabel">Exclude Month in Progress</span>
                  </label>
                </div>
              </div>

              <div id="revRangeWrapper" class="range-wrapper hidden">
                <label>Select Range:</label>
                <div class="range-container">
                  <input type="range" id="revRangeStart" min="2015" max="2025" value="2018" step="1">
                  <input type="range" id="revRangeEnd" min="2015" max="2025" value="2025" step="1">
                </div>
                <div class="range-labels">
                  <span id="revRangeStartLabel">2018</span>
                  <span id="revRangeEndLabel">2025</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="revAiAnalysisPanel" class="ai-analysis-panel">
          <div class="ai-analysis-header" id="revAiAnalysisHeader">
            <div class="ai-analysis-header-left">
              <span class="ai-analysis-toggle-icon">‚ñº</span>
              <span class="ai-analysis-title">AI ANALYSIS</span>
              <button type="button" id="revAiAnalyzeBtn" class="ai-run-btn">Run Analysis</button>
            </div>
          </div>
          <div id="revAiAnalysisBody" class="ai-analysis-body">
            <div id="revAiAnalysisContent" class="ai-analysis-content"></div>
          </div>
        </div>

        <!-- Revenue Chart with Summary Tiles -->
        <div class="chart-with-tiles">
          <div class="summary-tiles" id="revSummaryTiles">
            <div class="summary-tile">
              <div class="tile-label">Average</div>
              <div class="tile-value" id="revAvgValue">$0</div>
            </div>
            <div class="summary-tile">
              <div class="tile-label">Largest</div>
              <div class="tile-value" id="revMaxValue">$0</div>
              <div class="tile-sub" id="revMaxPeriod">-</div>
            </div>
            <div class="summary-tile">
              <div class="tile-label">Smallest</div>
              <div class="tile-value" id="revMinValue">$0</div>
              <div class="tile-sub" id="revMinPeriod">-</div>
            </div>
            <div class="summary-tile">
              <div class="tile-label">CAGR</div>
              <div class="tile-value" id="revCagrValue">0%</div>
            </div>
          </div>
          <div class="chart-box" id="revChartBox">
            <div id="revLoadingSpinner" class="loading-spinner hidden">
              <div class="spinner"></div>
              <span>Loading data...</span>
            </div>
            <div class="chart-header-row">
              <div class="chart-title">
                <div id="revChartTitleLine1">FTG Builders Revenue</div>
                <div id="revChartTitleLine2">Monthly ‚Äì 2025</div>
                <div id="revChartUpdated" class="chart-updated">Updated:</div>
              </div>
              <button class="chart-expand-btn" data-chart="revChart" data-title="Revenue" title="Expand chart"><svg viewBox="0 0 16 16" width="10" height="10"><path fill="currentColor" d="M2 2h5V0H0v7h2V2zm12 0h-5V0h7v7h-2V2zM2 14h5v2H0V9h2v5zm12 0h-5v2h7V9h-2v5z"/></svg></button>
            </div>
            <canvas id="revChart" style="width:100%; height:300px;"></canvas>
            <div id="revPartialLegend" class="partial-legend hidden">
              <span class="partial-indicator"></span> Partial period (month in progress)
            </div>
            <button class="breakdown-expand-btn" data-target="revTableWrapper">
              <span class="expand-text">Expand</span>
              <span class="expand-arrow">‚ñº</span>
            </button>
            <div class="breakdown-table-wrapper collapsed" id="revTableWrapper">
              <div class="table-header-row">
                <span>Revenue Breakdown</span>
                <button class="export-table-btn" id="revTableExportBtn" type="button">Export CSV</button>
              </div>
              <div class="table-scroll">
                <table id="revTable" class="breakdown-table">
                  <thead id="revTableHead"></thead>
                  <tbody id="revTableBody"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

      </section>

      <!-- ============================================================
           ACCOUNT VIEW
      ============================================================= -->
      <section id="accounts" class="dashboard-section">
        <h2>Account Detail</h2>
        <div class="data-as-of">Data as of: <span id="acctDataAsOf"></span></div>

        <div class="config-panel">
          <div class="config-header collapsed" data-target="acctConfigBody">
            <span class="config-toggle">‚ñº</span>
            <span class="config-title">Configuration Options</span>
            <button class="config-expand-btn">Expand ‚ñº</button>
          </div>
          <div class="config-body collapsed" id="acctConfigBody">
            <div class="saved-views-row">
              <select id="acctSavedViews" class="saved-views-select">
                <option value="">-- Current Settings --</option>
              </select>
              <button type="button" id="acctSaveViewBtn" class="save-view-btn">Save View</button>
              <button type="button" id="acctDeleteViewBtn" class="delete-view-btn" title="Delete selected view"<svg viewBox="0 0 16 16" width="12" height="12"><path fill="currentColor" d="M2.5 1L8 6.5 13.5 1 15 2.5 9.5 8 15 13.5 13.5 15 8 9.5 2.5 15 1 13.5 6.5 8 1 2.5 2.5 1z"/></svg></button>
            </div>
            <div class="rev-controls">
              <label style="display: block; font-weight: 600; margin-bottom: 8px;">Account:</label>
              <select id="acctSelect" style="display: block; margin-bottom: 12px; width: 100%;"></select>

              <div class="overview-config-box">
                <div style="font-weight: 600; margin-bottom: 8px; color: #374151;">Time Period:</div>
                <div class="dropdown-stack">
                  <div class="dropdown-row">
                    <label>View:</label>
                    <select id="acctViewType">
                      <option value="monthly">Monthly</option>
                      <option value="quarterly">Quarterly</option>
                      <option value="annual">Annual</option>
                    </select>
                  </div>
                  <div id="acctYearWrapper" class="dropdown-row">
                    <label>Year:</label>
                    <select id="acctYear"></select>
                  </div>
                </div>
              </div>

              <div id="acctRangeWrapper" class="range-wrapper hidden">
                <label>Select Range:</label>
                <div class="range-container">
                  <input type="range" id="acctRangeStart" min="2015" max="2025" value="2015" step="1">
                  <input type="range" id="acctRangeEnd" min="2015" max="2025" value="2025" step="1">
                </div>
                <div class="range-labels">
                  <span id="acctRangeStartLabel">2015</span>
                  <span id="acctRangeEndLabel">2025</span>
                </div>
              </div>

              <div class="overview-config-box">
                <div style="font-weight: 600; margin-bottom: 8px; color: #374151;">Visuals:</div>
                <div class="checkbox-stack">
                  <label class="checkbox-label">
                    <input type="checkbox" id="acctCompare">
                    Compare to Prior Year
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="acctTrendline">
                    Show Trendline
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="acctDataLabels">
                    Show Data Labels
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="acctExcludeCurrent" checked>
                    <span id="acctExcludeLabel">Exclude Month in Progress</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="acctAiAnalysisPanel" class="ai-analysis-panel">
          <div class="ai-analysis-header" id="acctAiAnalysisHeader">
            <div class="ai-analysis-header-left">
              <span class="ai-analysis-toggle-icon">‚ñº</span>
              <span class="ai-analysis-title">AI ANALYSIS</span>
              <button type="button" id="acctAiAnalyzeBtn" class="ai-run-btn">Run Analysis</button>
            </div>
          </div>
          <div id="acctAiAnalysisBody" class="ai-analysis-body">
            <div id="acctAiAnalysisContent" class="ai-analysis-content"></div>
          </div>
        </div>

        <!-- Account Chart with Summary Tiles -->
        <div class="chart-with-tiles">
          <div class="summary-tiles" id="acctSummaryTiles">
            <div class="summary-tile">
              <div class="tile-label">Average</div>
              <div class="tile-value" id="acctAvgValue">$0</div>
            </div>
            <div class="summary-tile">
              <div class="tile-label">Largest</div>
              <div class="tile-value" id="acctMaxValue">$0</div>
              <div class="tile-sub" id="acctMaxPeriod">-</div>
            </div>
            <div class="summary-tile">
              <div class="tile-label">Smallest</div>
              <div class="tile-value" id="acctMinValue">$0</div>
              <div class="tile-sub" id="acctMinPeriod">-</div>
            </div>
            <div class="summary-tile">
              <div class="tile-label">CAGR</div>
              <div class="tile-value" id="acctCagrValue">0%</div>
            </div>
          </div>
          <div class="chart-box" id="acctChartBox">
            <div id="acctLoadingSpinner" class="loading-spinner hidden">
              <div class="spinner"></div>
              <span>Loading data...</span>
            </div>
            <div class="chart-header-row">
              <div class="chart-title">
                <div id="acctChartTitleLine1">Account Activity</div>
                <div id="acctChartTitleLine2">Monthly ‚Äì 2025</div>
                <div id="acctChartUpdated" class="chart-updated">Updated:</div>
              </div>
              <button class="chart-expand-btn" data-chart="acctChart" data-title="Account Detail" title="Expand chart"><svg viewBox="0 0 16 16" width="10" height="10"><path fill="currentColor" d="M2 2h5V0H0v7h2V2zm12 0h-5V0h7v7h-2V2zM2 14h5v2H0V9h2v5zm12 0h-5v2h7V9h-2v5z"/></svg></button>
            </div>
            <canvas id="acctChart" style="width:100%; height:300px;"></canvas>
            <div id="acctPartialLegend" class="partial-legend hidden">
              <span class="partial-indicator"></span> Partial period (month in progress)
            </div>
            <button class="breakdown-expand-btn" data-target="acctTableWrapper">
              <span class="expand-text">Expand</span>
              <span class="expand-arrow">‚ñº</span>
            </button>
            <div class="breakdown-table-wrapper collapsed" id="acctTableWrapper">
              <div class="table-header-row">
                <span>Account Breakdown</span>
                <button class="export-table-btn" id="acctTableExportBtn" type="button">Export CSV</button>
              </div>
              <div class="table-scroll">
                <table id="acctTable" class="breakdown-table acct-table">
                  <thead id="acctTableHead"></thead>
                  <tbody id="acctTableBody"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

      </section>

      <!-- ============================================================
           INCOME STATEMENT
      ============================================================= -->
      <section id="incomeStatement" class="dashboard-section">
        <h2>Income Statement</h2>
        <div class="data-as-of">Data as of: <span id="isDataAsOf"></span></div>

        <div class="config-panel">
          <div class="config-header collapsed" data-target="isConfigBody">
            <span class="config-toggle">‚ñº</span>
            <span class="config-title">Configuration Options</span>
            <button class="config-expand-btn">Expand ‚ñº</button>
          </div>
          <div class="config-body collapsed" id="isConfigBody">
            <div class="saved-views-row">
              <select id="isSavedViews" class="saved-views-select">
                <option value="">-- Current Settings --</option>
              </select>
              <button type="button" id="isSaveViewBtn" class="save-view-btn">Save View</button>
              <button type="button" id="isDeleteViewBtn" class="delete-view-btn" title="Delete selected view"<svg viewBox="0 0 16 16" width="12" height="12"><path fill="currentColor" d="M2.5 1L8 6.5 13.5 1 15 2.5 9.5 8 15 13.5 13.5 15 8 9.5 2.5 15 1 13.5 6.5 8 1 2.5 2.5 1z"/></svg></button>
            </div>
            <div class="is-controls">
              <div class="overview-config-box">
                <div style="font-weight: 600; margin-bottom: 8px; color: #374151;">Time Period:</div>
                <div class="is-period-stack">
                  <div class="is-period-row">
                    <label>View:</label>
                    <select id="isViewMode">
                      <option value="single">Single Period</option>
                      <option value="matrix">Matrix</option>
                    </select>
                  </div>
                  <div class="is-period-row">
                    <label>Period Type:</label>
                    <select id="isPeriodType">
                      <option value="month">Month</option>
                      <option value="quarter">Quarter</option>
                      <option value="year">Year</option>
                      <option value="ytd">YTD</option>
                      <option value="ttm">TTM</option>
                    </select>
                  </div>
                  <div class="is-period-row">
                    <label id="isPeriodSelectLabel">Period:</label>
                    <select id="isPeriodSelect"></select>
                  </div>
                </div>
              </div>

              <div class="is-compare-detail-wrapper">
                <div id="isSingleControls" class="is-options-stack is-compare-box">
                  <label style="font-weight: 600;">Compare:</label>
                  <div class="radio-group-stacked">
                    <label class="radio-label"><input type="radio" name="isCompareRadio" value="none" checked> None</label>
                    <label class="radio-label"><input type="radio" name="isCompareRadio" value="prior_period"> Prior Period</label>
                    <label class="radio-label"><input type="radio" name="isCompareRadio" value="prior_year"> Prior Year</label>
                  </div>
                </div>

                <div class="is-options-stack is-detail-box">
                  <label style="font-weight: 600;">Detail:</label>
                  <div class="radio-group-stacked">
                    <label class="radio-label"><input type="radio" name="isDetailLevel" value="summary" checked> Summary</label>
                    <label class="radio-label"><input type="radio" name="isDetailLevel" value="medium"> Medium</label>
                    <label class="radio-label"><input type="radio" name="isDetailLevel" value="account"> Account</label>
                  </div>
                </div>
              </div>

              <div id="isMatrixControls" class="hidden">
                <div id="isMatrixYearControls" class="range-wrapper hidden">
                  <label>Select Range:</label>
                  <div class="range-container">
                    <input type="range" id="isMatrixYearStart" min="2015" max="2025" value="2020" step="1">
                    <input type="range" id="isMatrixYearEnd" min="2015" max="2025" value="2025" step="1">
                  </div>
                  <div class="range-labels">
                    <span id="isMatrixYearStartLabel">2020</span>
                    <span id="isMatrixYearEndLabel">2025</span>
                  </div>
                </div>
              </div>

              <div class="is-options-stack">
                <label class="is-checkbox-label small" id="isShowSubtotalWrapper">
                  <input type="checkbox" id="isShowSubtotal">
                  Show Subtotal
                </label>
                <label class="is-checkbox-label small">
                  <input type="checkbox" id="isShowThousands">
                  Show in Thousands
                </label>
                <label class="is-checkbox-label small">
                  <input type="checkbox" id="isExcludeCurrent" checked>
                  Exclude Month in Progress
                </label>
              </div>
            </div>
          </div>
        </div>

        <div id="isAiAnalysisPanel" class="ai-analysis-panel">
          <div class="ai-analysis-header" id="isAiAnalysisHeader">
            <div class="ai-analysis-header-left">
              <span class="ai-analysis-toggle-icon">‚ñº</span>
              <span class="ai-analysis-title">AI ANALYSIS</span>
              <button type="button" id="isAiAnalyzeBtn" class="ai-run-btn">Run Analysis</button>
            </div>
          </div>
          <div id="isAiAnalysisBody" class="ai-analysis-body">
            <div id="isAiAnalysisContent" class="ai-analysis-content"></div>
          </div>
        </div>

        <div class="is-table-box">
          <div class="report-header" id="isReportHeader">
            <div class="report-header-company">FTG Builders</div>
            <div class="report-header-title">Income Statement</div>
            <div class="report-header-period" id="isReportPeriod"></div>
          </div>
          <table id="incomeStatementTable" class="is-table">
            <thead id="isTableHead"></thead>
            <tbody id="isTableBody"></tbody>
          </table>
          <div id="isPartialFootnote" class="partial-footnote hidden">
            <span class="is-partial-indicator">*</span> Partial period
          </div>
        </div>
      </section>

      <!-- ============================================================
           BALANCE SHEET
      ============================================================= -->
      <section id="balanceSheet" class="dashboard-section">
        <h2>Balance Sheet</h2>
        <div class="data-as-of">Data as of: <span id="bsDataAsOf"></span></div>

        <div class="config-panel">
          <div class="config-header collapsed" data-target="bsConfigBody">
            <span class="config-toggle">‚ñº</span>
            <span class="config-title">Configuration Options</span>
            <button class="config-expand-btn">Expand ‚ñº</button>
          </div>
          <div class="config-body collapsed" id="bsConfigBody">
            <div class="saved-views-row">
              <select id="bsSavedViews" class="saved-views-select">
                <option value="">-- Current Settings --</option>
              </select>
              <button type="button" id="bsSaveViewBtn" class="save-view-btn">Save View</button>
              <button type="button" id="bsDeleteViewBtn" class="delete-view-btn" title="Delete selected view"<svg viewBox="0 0 16 16" width="12" height="12"><path fill="currentColor" d="M2.5 1L8 6.5 13.5 1 15 2.5 9.5 8 15 13.5 13.5 15 8 9.5 2.5 15 1 13.5 6.5 8 1 2.5 2.5 1z"/></svg></button>
            </div>
            <div class="is-controls">
              <div class="overview-config-box">
                <div style="font-weight: 600; margin-bottom: 8px; color: #374151;">Time Period:</div>
                <div class="is-period-stack">
                  <div class="is-period-row">
                    <label>View:</label>
                    <select id="bsViewMode">
                      <option value="single">Single Period</option>
                      <option value="matrix">Matrix</option>
                    </select>
                  </div>
                  <div class="is-period-row" id="bsPeriodTypeRow" style="display: none;">
                    <label>Period Type:</label>
                    <select id="bsPeriodType">
                      <option value="month">Month</option>
                      <option value="quarter">Quarter</option>
                      <option value="annual">Annual</option>
                    </select>
                  </div>
                  <div class="is-period-row" id="bsSinglePeriodRow">
                    <label>As of Date:</label>
                    <select id="bsPeriodSelect"></select>
                  </div>
                  <div class="is-period-row" id="bsMatrixYearRow" style="display: none;">
                    <label>Year:</label>
                    <select id="bsMatrixYear"></select>
                  </div>
                </div>
              </div>

              <div id="bsMatrixRangeControls" class="range-wrapper" style="display: none;">
                <label>Select Range:</label>
                <div class="range-container">
                  <input type="range" id="bsMatrixYearStart" min="2015" max="2025" value="2020" step="1">
                  <input type="range" id="bsMatrixYearEnd" min="2015" max="2025" value="2025" step="1">
                </div>
                <div class="range-labels">
                  <span id="bsMatrixYearStartLabel">2020</span>
                  <span id="bsMatrixYearEndLabel">2025</span>
                </div>
              </div>

              <div class="is-compare-detail-wrapper">
                <div class="is-options-stack is-compare-box" id="bsSingleCompareBox">
                  <label style="font-weight: 600;">Compare:</label>
                  <div class="radio-group-stacked">
                    <label class="radio-label"><input type="radio" name="bsCompareRadio" value="none" checked> None</label>
                    <label class="radio-label"><input type="radio" name="bsCompareRadio" value="prior_month"> Prior Month</label>
                    <label class="radio-label"><input type="radio" name="bsCompareRadio" value="prior_year"> Prior Year</label>
                  </div>
                </div>

                <div class="is-options-stack is-detail-box">
                  <label style="font-weight: 600;">Detail:</label>
                  <div class="radio-group-stacked">
                    <label class="radio-label"><input type="radio" name="bsDetailLevel" value="summary" checked> Summary</label>
                    <label class="radio-label"><input type="radio" name="bsDetailLevel" value="medium"> Medium</label>
                    <label class="radio-label"><input type="radio" name="bsDetailLevel" value="account"> Account</label>
                  </div>
                </div>
              </div>

              <div class="is-options-stack">
                <label class="is-checkbox-label small">
                  <input type="checkbox" id="bsShowThousands">
                  Show in Thousands
                </label>
                <label class="is-checkbox-label small">
                  <input type="checkbox" id="bsExcludeCurrentMonth" checked>
                  Exclude Month in Progress
                </label>
              </div>
            </div>
          </div>
        </div>

        <div id="bsAiAnalysisPanel" class="ai-analysis-panel">
          <div class="ai-analysis-header" id="bsAiAnalysisHeader">
            <div class="ai-analysis-header-left">
              <span class="ai-analysis-toggle-icon">‚ñº</span>
              <span class="ai-analysis-title">AI ANALYSIS</span>
              <button type="button" id="bsAiAnalyzeBtn" class="ai-run-btn">Run Analysis</button>
            </div>
          </div>
          <div id="bsAiAnalysisBody" class="ai-analysis-body">
            <div id="bsAiAnalysisContent" class="ai-analysis-content"></div>
          </div>
        </div>

        <div class="is-table-box">
          <div class="report-header" id="bsReportHeader">
            <div class="report-header-company">FTG Builders</div>
            <div class="report-header-title">Balance Sheet</div>
            <div class="report-header-period" id="bsReportPeriod"></div>
          </div>
          <table id="balanceSheetTable" class="is-table">
            <thead id="bsTableHead"></thead>
            <tbody id="bsTableBody"></tbody>
          </table>
          <div id="bsPartialFootnote" class="partial-footnote hidden">
            <span class="is-partial-indicator">*</span> Partial period (month in progress)
          </div>
        </div>
      </section>

      <!-- ============================================================
           STATEMENT OF CASH FLOWS
      ============================================================= -->
      <section id="cashFlows" class="dashboard-section">
        <h2>Statement of Cash Flows</h2>
        <div class="data-as-of">Data as of: <span id="cfDataAsOf"></span></div>

        <div class="config-panel">
          <div class="config-header collapsed" data-target="cfConfigBody">
            <span class="config-toggle">‚ñº</span>
            <span class="config-title">Configuration Options</span>
            <button class="config-expand-btn">Expand ‚ñº</button>
          </div>
          <div class="config-body collapsed" id="cfConfigBody">
            <div class="saved-views-row">
              <select id="cfSavedViews" class="saved-views-select">
                <option value="">-- Current Settings --</option>
              </select>
              <button type="button" id="cfSaveViewBtn" class="save-view-btn">Save View</button>
              <button type="button" id="cfDeleteViewBtn" class="delete-view-btn" title="Delete selected view"<svg viewBox="0 0 16 16" width="12" height="12"><path fill="currentColor" d="M2.5 1L8 6.5 13.5 1 15 2.5 9.5 8 15 13.5 13.5 15 8 9.5 2.5 15 1 13.5 6.5 8 1 2.5 2.5 1z"/></svg></button>
            </div>
            <div class="is-controls">
              <div class="overview-config-box">
                <div style="font-weight: 600; margin-bottom: 8px; color: #374151;">Time Period:</div>
                <div class="is-period-stack">
                  <div class="is-period-row">
                    <label>View:</label>
                    <select id="cfViewMode">
                      <option value="single">Single Period</option>
                      <option value="matrix">Matrix</option>
                    </select>
                  </div>
                  <div class="is-period-row">
                    <label>Period Type:</label>
                    <select id="cfPeriodType">
                      <option value="month">Month</option>
                      <option value="quarter">Quarter</option>
                      <option value="year">Year</option>
                      <option value="ytd">YTD</option>
                      <option value="ttm">TTM</option>
                    </select>
                  </div>
                  <div class="is-period-row">
                    <label id="cfPeriodSelectLabel">Period:</label>
                    <select id="cfPeriodSelect"></select>
                  </div>
                </div>
              </div>

              <div class="is-compare-detail-wrapper">
                <div id="cfSingleControls" class="is-options-stack is-compare-box">
                  <label style="font-weight: 600;">Compare:</label>
                  <div class="radio-group-stacked">
                    <label class="radio-label"><input type="radio" name="cfCompareRadio" value="none" checked> None</label>
                    <label class="radio-label"><input type="radio" name="cfCompareRadio" value="prior_period"> Prior Period</label>
                    <label class="radio-label"><input type="radio" name="cfCompareRadio" value="prior_year"> Prior Year</label>
                  </div>
                </div>

                <div class="is-options-stack is-detail-box">
                  <label style="font-weight: 600;">Detail:</label>
                  <div class="radio-group-stacked">
                    <label class="radio-label"><input type="radio" name="cfDetailLevel" value="summary" checked> Summary</label>
                    <label class="radio-label"><input type="radio" name="cfDetailLevel" value="detailed"> Detailed</label>
                  </div>
                </div>
              </div>

              <div id="cfMatrixControls" class="hidden">
                <div id="cfMatrixYearControls" class="range-wrapper hidden">
                  <label>Select Range:</label>
                  <div class="range-container">
                    <input type="range" id="cfMatrixYearStart" min="2015" max="2025" value="2020" step="1">
                    <input type="range" id="cfMatrixYearEnd" min="2015" max="2025" value="2025" step="1">
                  </div>
                  <div class="range-labels">
                    <span id="cfMatrixYearStartLabel">2020</span>
                    <span id="cfMatrixYearEndLabel">2025</span>
                  </div>
                </div>
              </div>

              <div class="is-options-stack">
                <label class="is-checkbox-label small" id="cfShowSubtotalWrapper">
                  <input type="checkbox" id="cfShowSubtotal">
                  Show Subtotal
                </label>
                <label class="is-checkbox-label small">
                  <input type="checkbox" id="cfShowThousands">
                  Show in Thousands
                </label>
                <label class="is-checkbox-label small">
                  <input type="checkbox" id="cfExcludeCurrent" checked>
                  Exclude Month in Progress
                </label>
                <label class="is-checkbox-label small">
                  <input type="checkbox" id="cfExcludeSchwab" checked>
                  Exclude Schwab (1004)
                </label>
              </div>
            </div>
          </div>
        </div>

        <div id="cfAiAnalysisPanel" class="ai-analysis-panel">
          <div class="ai-analysis-header" id="cfAiAnalysisHeader">
            <div class="ai-analysis-header-left">
              <span class="ai-analysis-toggle-icon">‚ñº</span>
              <span class="ai-analysis-title">AI ANALYSIS</span>
              <button type="button" id="cfAiAnalyzeBtn" class="ai-run-btn">Run Analysis</button>
            </div>
          </div>
          <div id="cfAiAnalysisBody" class="ai-analysis-body">
            <div id="cfAiAnalysisContent" class="ai-analysis-content"></div>
          </div>
        </div>

        <div class="is-table-box">
          <div class="report-header" id="cfReportHeader">
            <div class="report-header-company">FTG Builders</div>
            <div class="report-header-title">Statement of Cash Flows</div>
            <div class="report-header-period" id="cfReportPeriod"></div>
          </div>
          <table id="cashFlowTable" class="is-table">
            <thead id="cfTableHead"></thead>
            <tbody id="cfTableBody"></tbody>
          </table>
          <div id="cfPartialFootnote" class="partial-footnote hidden">
            <span class="is-partial-indicator">*</span> Partial period
          </div>
        </div>
      </section>

      <!-- ============================================================
           JOB OVERVIEW
      ============================================================= -->
      <section id="jobOverview" class="dashboard-section">
        <h2>Job Overview</h2>
        <div class="section-subtitle">Foundation</div>
        <div class="data-as-of">Data as of: <span id="jobOverviewDataAsOf">-</span></div>

        <!-- Configuration Panel -->
        <div class="config-panel jo-config-panel">
          <div class="config-header collapsed" data-target="jobOverviewConfigBody">
            <span class="config-toggle">‚ñº</span>
            <span class="config-title">Configuration Options</span>
            <button class="config-expand-btn">Expand ‚ñº</button>
          </div>
          <div class="config-body collapsed" id="jobOverviewConfigBody">
            <div class="job-budgets-controls">
              <div class="overview-config-box">
                <div class="config-label">Job Status:</div>
                <div class="checkbox-stack">
                  <label class="checkbox-label">
                    <input type="checkbox" id="joStatusActive" checked>
                    Active
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="joStatusInactive">
                    Inactive
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="joStatusClosed">
                    Closed
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="joStatusOverhead">
                    Overhead
                  </label>
                </div>
              </div>

              <div class="overview-config-box job-filter-stack">
                <select id="joPmFilter" class="filter-select">
                  <option value="">All Project Managers</option>
                </select>
                <select id="joCustomerFilter" class="filter-select">
                  <option value="">All Clients</option>
                </select>
              </div>

              <div class="overview-config-box">
                <div class="config-label">Options:</div>
                <div class="checkbox-stack">
                  <label class="checkbox-label">
                    <input type="checkbox" id="joDataLabels" checked>
                    Data Labels
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- AI Analysis Panel -->
        <div id="joAiAnalysisPanel" class="ai-analysis-panel">
          <div class="ai-analysis-header" id="joAiAnalysisHeader">
            <div class="ai-analysis-header-left">
              <span class="ai-analysis-toggle-icon">‚ñº</span>
              <span class="ai-analysis-title">AI ANALYSIS</span>
              <button type="button" id="joAiAnalyzeBtn" class="ai-run-btn">Run Analysis</button>
            </div>
          </div>
          <div id="joAiAnalysisBody" class="ai-analysis-body">
            <div id="joAiAnalysisContent" class="ai-analysis-content"></div>
          </div>
        </div>

        <!-- Key Metrics Tiles Row - 5 tiles across -->
        <div class="job-key-metrics-section jo-key-metrics-constrained">
          <h3 class="jo-section-header">Key Metrics</h3>
          <div class="jo-metrics-row jo-metrics-row-5">
            <div class="job-metric-card compact primary">
              <div class="metric-icon">üìã</div>
              <div class="metric-content">
                <div class="metric-value" id="joTotalJobs">-</div>
                <div class="metric-label">Total Jobs</div>
              </div>
            </div>
            <div class="job-metric-card compact">
              <div class="metric-icon">üìÑ</div>
              <div class="metric-content">
                <div class="metric-value" id="joContractValue">-</div>
                <div class="metric-label">Contract Value</div>
              </div>
            </div>
            <div class="job-metric-card compact">
              <div class="metric-icon">üí∞</div>
              <div class="metric-content">
                <div class="metric-value" id="joBilledRevenue">-</div>
                <div class="metric-label">Billed Revenue</div>
              </div>
            </div>
            <div class="job-metric-card compact" id="joOverUnderTile">
              <div class="metric-icon">üíµ</div>
              <div class="metric-content">
                <div class="metric-value" id="joOverUnderValue">-</div>
                <div class="metric-label">Over/(Under) Bill</div>
              </div>
            </div>
            <div class="job-metric-card compact">
              <div class="metric-icon">üìä</div>
              <div class="metric-content">
                <div class="metric-value" id="joEstProfitMargin">-</div>
                <div class="metric-label">Est. Profit Margin</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Key Metrics by Project Manager -->
        <div class="job-overview-charts">
          <h3 class="jo-section-header">Key Metrics by Project Manager</h3>
          <div class="jo-chart-grid-3">
            <div class="overview-chart-card">
              <div class="chart-title"># of Jobs</div>
              <div class="chart-container">
                <canvas id="joPmJobsChart"></canvas>
              </div>
              <div class="chart-stats jo-chart-stats">
                <div class="stat-box"><div class="stat-label">Average</div><div class="stat-value" id="joPmJobsAvg">-</div></div>
                <div class="stat-box"><div class="stat-label">Highest</div><div class="stat-value" id="joPmJobsHigh">-</div><div class="stat-period" id="joPmJobsHighName"></div></div>
                <div class="stat-box"><div class="stat-label">Lowest</div><div class="stat-value" id="joPmJobsLow">-</div><div class="stat-period" id="joPmJobsLowName"></div></div>
              </div>
            </div>
            <div class="overview-chart-card">
              <div class="chart-title">Contract Value</div>
              <div class="chart-container">
                <canvas id="joPmContractChart"></canvas>
              </div>
              <div class="chart-stats jo-chart-stats">
                <div class="stat-box"><div class="stat-label">Average</div><div class="stat-value" id="joPmContractAvg">-</div></div>
                <div class="stat-box"><div class="stat-label">Highest</div><div class="stat-value" id="joPmContractHigh">-</div><div class="stat-period" id="joPmContractHighName"></div></div>
                <div class="stat-box"><div class="stat-label">Lowest</div><div class="stat-value" id="joPmContractLow">-</div><div class="stat-period" id="joPmContractLowName"></div></div>
              </div>
            </div>
            <div class="overview-chart-card">
              <div class="chart-title">Est. Profit Margin %</div>
              <div class="chart-container">
                <canvas id="joPmMarginChart"></canvas>
              </div>
              <div class="chart-stats jo-chart-stats">
                <div class="stat-box"><div class="stat-label">Average</div><div class="stat-value" id="joPmMarginAvg">-</div></div>
                <div class="stat-box"><div class="stat-label">Highest</div><div class="stat-value" id="joPmMarginHigh">-</div><div class="stat-period" id="joPmMarginHighName"></div></div>
                <div class="stat-box"><div class="stat-label">Lowest</div><div class="stat-value" id="joPmMarginLow">-</div><div class="stat-period" id="joPmMarginLowName"></div></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Key Metrics by Client -->
        <div class="job-overview-charts">
          <h3 class="jo-section-header">Key Metrics by Client</h3>
          <div class="jo-chart-grid-3">
            <div class="overview-chart-card">
              <div class="chart-title"># of Jobs</div>
              <div class="chart-container">
                <canvas id="joClientJobsChart"></canvas>
              </div>
              <div class="chart-stats jo-chart-stats">
                <div class="stat-box"><div class="stat-label">Average</div><div class="stat-value" id="joClientJobsAvg">-</div></div>
                <div class="stat-box"><div class="stat-label">Highest</div><div class="stat-value" id="joClientJobsHigh">-</div><div class="stat-period" id="joClientJobsHighName"></div></div>
                <div class="stat-box"><div class="stat-label">Lowest</div><div class="stat-value" id="joClientJobsLow">-</div><div class="stat-period" id="joClientJobsLowName"></div></div>
              </div>
            </div>
            <div class="overview-chart-card">
              <div class="chart-title">Contract Value</div>
              <div class="chart-container">
                <canvas id="joClientContractChart"></canvas>
              </div>
              <div class="chart-stats jo-chart-stats">
                <div class="stat-box"><div class="stat-label">Average</div><div class="stat-value" id="joClientContractAvg">-</div></div>
                <div class="stat-box"><div class="stat-label">Highest</div><div class="stat-value" id="joClientContractHigh">-</div><div class="stat-period" id="joClientContractHighName"></div></div>
                <div class="stat-box"><div class="stat-label">Lowest</div><div class="stat-value" id="joClientContractLow">-</div><div class="stat-period" id="joClientContractLowName"></div></div>
              </div>
            </div>
            <div class="overview-chart-card">
              <div class="chart-title">Est. Profit Margin %</div>
              <div class="chart-container">
                <canvas id="joClientMarginChart"></canvas>
              </div>
              <div class="chart-stats jo-chart-stats">
                <div class="stat-box"><div class="stat-label">Average</div><div class="stat-value" id="joClientMarginAvg">-</div></div>
                <div class="stat-box"><div class="stat-label">Highest</div><div class="stat-value" id="joClientMarginHigh">-</div><div class="stat-period" id="joClientMarginHighName"></div></div>
                <div class="stat-box"><div class="stat-label">Lowest</div><div class="stat-value" id="joClientMarginLow">-</div><div class="stat-period" id="joClientMarginLowName"></div></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ============================================================
           JOB BUDGETS
      ============================================================= -->
      <section id="jobBudgets" class="dashboard-section">
        <h2>Job Budgets</h2>
        <div class="data-as-of">Data as of: <span id="jobBudgetsDataAsOf">-</span></div>

        <!-- AI Analysis Panel -->
        <div id="jbAiAnalysisPanel" class="ai-analysis-panel">
          <div class="ai-analysis-header" id="jbAiAnalysisHeader">
            <div class="ai-analysis-header-left">
              <span class="ai-analysis-toggle-icon">‚ñº</span>
              <span class="ai-analysis-title">AI ANALYSIS</span>
              <button type="button" id="jbAiAnalyzeBtn" class="ai-run-btn">Run Analysis</button>
            </div>
          </div>
          <div id="jbAiAnalysisBody" class="ai-analysis-body">
            <div id="jbAiAnalysisContent" class="ai-analysis-content"></div>
          </div>
        </div>

        <!-- Key Metrics Dashboard -->
        <div class="job-key-metrics-section">
          <h3 class="section-title">Key Metrics (Active Jobs)</h3>
          <div class="job-metrics-grid five-col">
            <div class="job-metric-card primary">
              <div class="metric-icon">üìã</div>
              <div class="metric-content">
                <div class="metric-value" id="jobTotalCount">-</div>
                <div class="metric-label">Total Jobs</div>
              </div>
            </div>
            <div class="job-metric-card">
              <div class="metric-icon">üí∞</div>
              <div class="metric-content">
                <div class="metric-value" id="jobTotalContract">-</div>
                <div class="metric-label">Contract Value</div>
              </div>
            </div>
            <div class="job-metric-card">
              <div class="metric-icon">üìä</div>
              <div class="metric-content">
                <div class="metric-value" id="jobTotalCost">-</div>
                <div class="metric-label">Est. Cost</div>
              </div>
            </div>
            <div class="job-metric-card profit">
              <div class="metric-icon">üìà</div>
              <div class="metric-content">
                <div class="metric-value" id="jobTotalProfit">-</div>
                <div class="metric-label">Est. Profit</div>
              </div>
            </div>
            <div class="job-metric-card margin">
              <div class="metric-icon">%</div>
              <div class="metric-content">
                <div class="metric-value" id="jobAvgMargin">-</div>
                <div class="metric-label">Avg Margin</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Breakdown Section -->
        <div class="job-breakdown-section">
          <div class="breakdown-container stacked">
            <div class="breakdown-card">
              <div class="chart-subtitle">Contract Value by Project Manager</div>
              <div class="donut-flex-container">
                <div class="donut-canvas-wrapper">
                  <canvas id="pmDonutChart"></canvas>
                </div>
                <div class="donut-legend" id="pmDonutLegend"></div>
              </div>
              <button class="breakdown-expand-btn" data-target="pmTableWrapper">
                <span class="expand-text">Expand</span>
                <span class="expand-arrow">‚ñº</span>
              </button>
              <div class="breakdown-table-wrapper collapsed" id="pmTableWrapper">
                <table class="breakdown-table" id="jobPmBreakdownTable">
                  <thead>
                    <tr>
                      <th>Project Manager</th>
                      <th class="number-col">Jobs</th>
                      <th class="number-col">Contract</th>
                      <th class="number-col">Cost</th>
                      <th class="number-col">Profit</th>
                      <th class="number-col">Margin</th>
                    </tr>
                  </thead>
                  <tbody id="jobPmBreakdownBody">
                    <tr><td colspan="6" class="loading-cell">Loading...</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="breakdown-card">
              <div class="chart-subtitle">Contract Value by Client</div>
              <div class="donut-flex-container">
                <div class="donut-canvas-wrapper">
                  <canvas id="customerDonutChart"></canvas>
                </div>
                <div class="donut-legend" id="customerDonutLegend"></div>
              </div>
              <button class="breakdown-expand-btn" data-target="customerTableWrapper">
                <span class="expand-text">Expand</span>
                <span class="expand-arrow">‚ñº</span>
              </button>
              <div class="breakdown-table-wrapper collapsed" id="customerTableWrapper">
                <table class="breakdown-table" id="jobCustomerBreakdownTable">
                  <thead>
                    <tr>
                      <th>Client</th>
                      <th class="number-col">Jobs</th>
                      <th class="number-col">Contract</th>
                      <th class="number-col">Cost</th>
                      <th class="number-col">Profit</th>
                      <th class="number-col">Margin</th>
                    </tr>
                  </thead>
                  <tbody id="jobCustomerBreakdownBody">
                    <tr><td colspan="6" class="loading-cell">Loading...</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Configuration Panel -->
        <div class="config-panel">
          <div class="config-header collapsed" data-target="jobBudgetsConfigBody">
            <span class="config-toggle">‚ñº</span>
            <span class="config-title">Configuration Options</span>
            <button class="config-expand-btn">Expand ‚ñº</button>
          </div>
          <div class="config-body collapsed" id="jobBudgetsConfigBody">
            <div class="job-budgets-controls">
              <div class="overview-config-box">
                <div class="config-label">Job Status:</div>
                <div class="checkbox-stack">
                  <label class="checkbox-label">
                    <input type="checkbox" id="jobStatusActive" checked>
                    Active
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="jobStatusInactive">
                    Inactive
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="jobStatusClosed">
                    Closed
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="jobStatusOverhead">
                    Overhead
                  </label>
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- Search Bar and Column Picker -->
        <div class="table-toolbar">
          <div class="job-search-bar">
            <input type="text" id="jobSearchInput" placeholder="Search by job number, description, or client..." class="job-search-input">
            <span class="job-search-icon">üîç</span>
          </div>
          <div class="column-picker-container">
            <button class="column-picker-btn" id="budgetsColumnPickerBtn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="7" height="7"></rect>
                <rect x="14" y="3" width="7" height="7"></rect>
                <rect x="3" y="14" width="7" height="7"></rect>
                <rect x="14" y="14" width="7" height="7"></rect>
              </svg>
              <span>Columns</span>
            </button>
            <div class="column-picker-dropdown" id="budgetsColumnPickerDropdown">
              <div class="column-picker-header">
                <span class="column-picker-title">Show/Hide Columns</span>
                <button class="column-picker-close" id="budgetsColumnPickerClose">&times;</button>
              </div>
              <div class="column-picker-body" id="budgetsColumnPickerBody">
              </div>
              <div class="column-picker-footer">
                <button class="column-picker-reset" id="budgetsColumnPickerReset">Reset</button>
                <button class="column-picker-apply" id="budgetsColumnPickerApply">Apply</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Sort Buttons -->
        <div class="quick-sort-buttons">
          <span class="quick-sort-label">Quick Sort:</span>
          <button class="quick-sort-btn" data-sort="revised_contract" data-dir="desc">Highest Contract Value</button>
          <button class="quick-sort-btn" data-sort="profit_margin" data-dir="desc">Highest Profit Margin %</button>
          <button class="quick-sort-btn" data-sort="profit_margin" data-dir="asc">Lowest Profit Margin %</button>
        </div>

        <!-- Jobs Table -->
        <div class="job-table-container">
          <div class="loading-overlay hidden" id="jobBudgetsLoadingOverlay">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading...</div>
          </div>
          <table class="job-budgets-table" id="jobBudgetsTable">
            <thead>
              <tr>
                <th class="filterable" data-sort="job_no" data-filter="job_no">
                  <span class="column-header-text">Job #</span>
                  <div class="column-controls">
                    <div class="sort-controls">
                      <button class="sort-btn sort-asc-btn" data-sort="job_no" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                      <button class="sort-btn sort-desc-btn" data-sort="job_no" data-dir="desc" title="Sort descending">‚ñº</button>
                    </div>
                    <button class="filter-btn" data-filter="job_no" title="Filter">‚ñº</button>
                  </div>
                  <div class="column-filter-dropdown" data-filter="job_no"></div>
                </th>
                <th class="filterable" data-sort="job_description" data-filter="job_description">
                  <span class="column-header-text">Description</span>
                  <div class="column-controls">
                    <div class="sort-controls">
                      <button class="sort-btn sort-asc-btn" data-sort="job_description" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                      <button class="sort-btn sort-desc-btn" data-sort="job_description" data-dir="desc" title="Sort descending">‚ñº</button>
                    </div>
                    <button class="filter-btn" data-filter="job_description" title="Filter">‚ñº</button>
                  </div>
                  <div class="column-filter-dropdown" data-filter="job_description"></div>
                </th>
                <th class="filterable" data-sort="customer_name" data-filter="customer_name">
                  <span class="column-header-text">Client</span>
                  <div class="column-controls">
                    <div class="sort-controls">
                      <button class="sort-btn sort-asc-btn" data-sort="customer_name" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                      <button class="sort-btn sort-desc-btn" data-sort="customer_name" data-dir="desc" title="Sort descending">‚ñº</button>
                    </div>
                    <button class="filter-btn" data-filter="customer_name" title="Filter">‚ñº</button>
                  </div>
                  <div class="column-filter-dropdown" data-filter="customer_name"></div>
                </th>
                <th class="filterable" data-sort="job_status" data-filter="job_status">
                  <span class="column-header-text">Status</span>
                  <div class="column-controls">
                    <div class="sort-controls">
                      <button class="sort-btn sort-asc-btn" data-sort="job_status" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                      <button class="sort-btn sort-desc-btn" data-sort="job_status" data-dir="desc" title="Sort descending">‚ñº</button>
                    </div>
                    <button class="filter-btn" data-filter="job_status" title="Filter">‚ñº</button>
                  </div>
                  <div class="column-filter-dropdown" data-filter="job_status"></div>
                </th>
                <th class="filterable" data-sort="project_manager_name" data-filter="project_manager_name">
                  <span class="column-header-text">Project Manager</span>
                  <div class="column-controls">
                    <div class="sort-controls">
                      <button class="sort-btn sort-asc-btn" data-sort="project_manager_name" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                      <button class="sort-btn sort-desc-btn" data-sort="project_manager_name" data-dir="desc" title="Sort descending">‚ñº</button>
                    </div>
                    <button class="filter-btn" data-filter="project_manager_name" title="Filter">‚ñº</button>
                  </div>
                  <div class="column-filter-dropdown" data-filter="project_manager_name"></div>
                </th>
                <th class="number-col contract-detail-col hidden" data-sort="original_contract">Original Contract</th>
                <th class="number-col contract-detail-col hidden" data-sort="tot_income_adj">Change Orders</th>
                <th class="number-col revised-contract-col expandable-col sortable-number" data-sort="revised_contract">
                  <span class="expand-icon" data-expand="contract">‚ñ∂</span>
                  <span class="column-header-text">Contract Value</span>
                  <div class="sort-controls inline-sort">
                    <button class="sort-btn sort-asc-btn" data-sort="revised_contract" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                    <button class="sort-btn sort-desc-btn" data-sort="revised_contract" data-dir="desc" title="Sort descending">‚ñº</button>
                  </div>
                </th>
                <th class="number-col cost-detail-col hidden" data-sort="original_cost">Original Cost</th>
                <th class="number-col cost-detail-col hidden" data-sort="tot_cost_adj">Cost Adjustments</th>
                <th class="number-col revised-cost-col expandable-col sortable-number" data-sort="revised_cost">
                  <span class="expand-icon" data-expand="cost">‚ñ∂</span>
                  <span class="column-header-text">Projected Cost</span>
                  <div class="sort-controls inline-sort">
                    <button class="sort-btn sort-asc-btn" data-sort="revised_cost" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                    <button class="sort-btn sort-desc-btn" data-sort="revised_cost" data-dir="desc" title="Sort descending">‚ñº</button>
                  </div>
                </th>
                <th class="number-col sortable-number" data-sort="estimated_profit">
                  <span class="column-header-text">Estimated Profit</span>
                  <div class="sort-controls inline-sort">
                    <button class="sort-btn sort-asc-btn" data-sort="estimated_profit" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                    <button class="sort-btn sort-desc-btn" data-sort="estimated_profit" data-dir="desc" title="Sort descending">‚ñº</button>
                  </div>
                </th>
                <th class="number-col sortable-number" data-sort="profit_margin">
                  <span class="column-header-text">Profit Margin</span>
                  <div class="sort-controls inline-sort">
                    <button class="sort-btn sort-asc-btn" data-sort="profit_margin" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                    <button class="sort-btn sort-desc-btn" data-sort="profit_margin" data-dir="desc" title="Sort descending">‚ñº</button>
                  </div>
                </th>
              </tr>
            </thead>
            <tbody id="jobBudgetsTableBody">
              <tr><td colspan="12" class="loading-cell">Loading job data...</td></tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="job-pagination" id="jobPagination">
          <button id="jobPrevPage" class="pagination-btn" disabled>‚Üê Previous</button>
          <span id="jobPageInfo" class="page-info">Page 1 of 1</span>
          <button id="jobNextPage" class="pagination-btn" disabled>Next ‚Üí</button>
          <select id="jobPageSize" class="page-size-select">
            <option value="25" selected>25 per page</option>
            <option value="50">50 per page</option>
            <option value="100">100 per page</option>
            <option value="250">250 per page</option>
          </select>
        </div>
      </section>

      <!-- ============================================================
           JOB ACTUALS
      ============================================================= -->
      <section id="jobActuals" class="dashboard-section">
        <h2>Job Actuals</h2>
        <div class="data-as-of">Data as of: <span id="jobActualsDataAsOf">-</span></div>

        <!-- AI Analysis Panel -->
        <div id="jaAiAnalysisPanel" class="ai-analysis-panel">
          <div class="ai-analysis-header" id="jaAiAnalysisHeader">
            <div class="ai-analysis-header-left">
              <span class="ai-analysis-toggle-icon">‚ñº</span>
              <span class="ai-analysis-title">AI ANALYSIS</span>
              <button type="button" id="jaAiAnalyzeBtn" class="ai-run-btn">Run Analysis</button>
            </div>
          </div>
          <div id="jaAiAnalysisBody" class="ai-analysis-body">
            <div id="jaAiAnalysisContent" class="ai-analysis-content"></div>
          </div>
        </div>

        <!-- Key Metrics Dashboard -->
        <div class="job-key-metrics-section">
          <h3 class="section-title">Key Metrics (Active Jobs)</h3>
          <div class="job-metrics-grid five-col">
            <div class="job-metric-card primary">
              <div class="metric-icon">üìã</div>
              <div class="metric-content">
                <div class="metric-value" id="jaTotalCount">-</div>
                <div class="metric-label">Total Jobs</div>
              </div>
            </div>
            <div class="job-metric-card">
              <div class="metric-icon">üíµ</div>
              <div class="metric-content">
                <div class="metric-value" id="jaTotalBilledRevenue">-</div>
                <div class="metric-label">Billed Revenue</div>
              </div>
            </div>
            <div class="job-metric-card">
              <div class="metric-icon">üìà</div>
              <div class="metric-content">
                <div class="metric-value" id="jaTotalEarnedRevenue">-</div>
                <div class="metric-label">Earned Revenue</div>
              </div>
            </div>
            <div class="job-metric-card">
              <div class="metric-icon">üìä</div>
              <div class="metric-content">
                <div class="metric-value" id="jaTotalActualCost">-</div>
                <div class="metric-label">Actual Cost</div>
              </div>
            </div>
            <div class="job-metric-card" id="jaOverUnderCard">
              <div class="metric-icon">‚öñÔ∏è</div>
              <div class="metric-content">
                <div class="metric-value" id="jaTotalOverUnder">-</div>
                <div class="metric-label">Over/(Under) Bill</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Configuration Panel -->
        <div class="config-panel">
          <div class="config-header collapsed" data-target="jobActualsConfigBody">
            <span class="config-toggle">‚ñº</span>
            <span class="config-title">Configuration Options</span>
            <button class="config-expand-btn">Expand ‚ñº</button>
          </div>
          <div class="config-body collapsed" id="jobActualsConfigBody">
            <div class="job-budgets-controls">
              <div class="overview-config-box">
                <div class="config-label">Job Status:</div>
                <div class="checkbox-stack">
                  <label class="checkbox-label">
                    <input type="checkbox" id="jaStatusActive" checked>
                    Active
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="jaStatusInactive">
                    Inactive
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="jaStatusClosed">
                    Closed
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="jaStatusOverhead">
                    Overhead
                  </label>
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- Search Bar and Column Picker -->
        <div class="table-toolbar">
          <div class="job-search-bar">
            <input type="text" id="jaSearchInput" placeholder="Search by job number, description, or client..." class="job-search-input">
            <span class="job-search-icon">üîç</span>
          </div>
          <div class="column-picker-container">
            <button class="column-picker-btn" id="actualsColumnPickerBtn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="7" height="7"></rect>
                <rect x="14" y="3" width="7" height="7"></rect>
                <rect x="3" y="14" width="7" height="7"></rect>
                <rect x="14" y="14" width="7" height="7"></rect>
              </svg>
              <span>Columns</span>
            </button>
            <div class="column-picker-dropdown" id="actualsColumnPickerDropdown">
              <div class="column-picker-header">
                <span class="column-picker-title">Show/Hide Columns</span>
                <button class="column-picker-close" id="actualsColumnPickerClose">&times;</button>
              </div>
              <div class="column-picker-body" id="actualsColumnPickerBody">
              </div>
              <div class="column-picker-footer">
                <button class="column-picker-reset" id="actualsColumnPickerReset">Reset</button>
                <button class="column-picker-apply" id="actualsColumnPickerApply">Apply</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Sort Buttons -->
        <div class="quick-sort-buttons">
          <span class="quick-sort-label">Quick Sort:</span>
          <button class="quick-sort-btn ja-quick-sort" data-sort="actual_cost" data-dir="desc">Highest Actual Cost</button>
          <button class="quick-sort-btn ja-quick-sort" data-sort="earned_revenue" data-dir="desc">Highest Earned Revenue</button>
          <button class="quick-sort-btn ja-quick-sort" data-sort="percent_complete" data-dir="desc">Highest % Complete</button>
        </div>

        <!-- Jobs Table -->
        <div class="job-table-container">
          <div class="loading-overlay hidden" id="jobActualsLoadingOverlay">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading...</div>
          </div>
          <table class="job-budgets-table" id="jobActualsTable">
            <thead>
              <tr>
                <th class="filterable" data-sort="job_no" data-filter="job_no">
                  <span class="column-header-text">Job #</span>
                  <div class="column-controls">
                    <div class="sort-controls">
                      <button class="sort-btn sort-asc-btn ja-sort-btn" data-sort="job_no" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                      <button class="sort-btn sort-desc-btn ja-sort-btn" data-sort="job_no" data-dir="desc" title="Sort descending">‚ñº</button>
                    </div>
                    <button class="filter-btn ja-filter-btn" data-filter="job_no" title="Filter">‚ñº</button>
                  </div>
                  <div class="column-filter-dropdown ja-filter-dropdown" data-filter="job_no"></div>
                </th>
                <th class="filterable" data-sort="job_description" data-filter="job_description">
                  <span class="column-header-text">Description</span>
                  <div class="column-controls">
                    <div class="sort-controls">
                      <button class="sort-btn sort-asc-btn ja-sort-btn" data-sort="job_description" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                      <button class="sort-btn sort-desc-btn ja-sort-btn" data-sort="job_description" data-dir="desc" title="Sort descending">‚ñº</button>
                    </div>
                    <button class="filter-btn ja-filter-btn" data-filter="job_description" title="Filter">‚ñº</button>
                  </div>
                  <div class="column-filter-dropdown ja-filter-dropdown" data-filter="job_description"></div>
                </th>
                <th class="filterable" data-sort="customer_name" data-filter="customer_name">
                  <span class="column-header-text">Client</span>
                  <div class="column-controls">
                    <div class="sort-controls">
                      <button class="sort-btn sort-asc-btn ja-sort-btn" data-sort="customer_name" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                      <button class="sort-btn sort-desc-btn ja-sort-btn" data-sort="customer_name" data-dir="desc" title="Sort descending">‚ñº</button>
                    </div>
                    <button class="filter-btn ja-filter-btn" data-filter="customer_name" title="Filter">‚ñº</button>
                  </div>
                  <div class="column-filter-dropdown ja-filter-dropdown" data-filter="customer_name"></div>
                </th>
                <th class="filterable" data-sort="job_status" data-filter="job_status">
                  <span class="column-header-text">Status</span>
                  <div class="column-controls">
                    <div class="sort-controls">
                      <button class="sort-btn sort-asc-btn ja-sort-btn" data-sort="job_status" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                      <button class="sort-btn sort-desc-btn ja-sort-btn" data-sort="job_status" data-dir="desc" title="Sort descending">‚ñº</button>
                    </div>
                    <button class="filter-btn ja-filter-btn" data-filter="job_status" title="Filter">‚ñº</button>
                  </div>
                  <div class="column-filter-dropdown ja-filter-dropdown" data-filter="job_status"></div>
                </th>
                <th class="filterable" data-sort="project_manager_name" data-filter="project_manager_name">
                  <span class="column-header-text">Project Manager</span>
                  <div class="column-controls">
                    <div class="sort-controls">
                      <button class="sort-btn sort-asc-btn ja-sort-btn" data-sort="project_manager_name" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                      <button class="sort-btn sort-desc-btn ja-sort-btn" data-sort="project_manager_name" data-dir="desc" title="Sort descending">‚ñº</button>
                    </div>
                    <button class="filter-btn ja-filter-btn" data-filter="project_manager_name" title="Filter">‚ñº</button>
                  </div>
                  <div class="column-filter-dropdown ja-filter-dropdown" data-filter="project_manager_name"></div>
                </th>
                <th class="number-col sortable-number" data-sort="billed_revenue">
                  <span class="column-header-text">Billed Revenue</span>
                  <div class="sort-controls inline-sort">
                    <button class="sort-btn sort-asc-btn ja-sort-btn" data-sort="billed_revenue" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                    <button class="sort-btn sort-desc-btn ja-sort-btn" data-sort="billed_revenue" data-dir="desc" title="Sort descending">‚ñº</button>
                  </div>
                </th>
                <th class="number-col sortable-number" data-sort="earned_revenue">
                  <span class="column-header-text">Earned Revenue</span>
                  <div class="sort-controls inline-sort">
                    <button class="sort-btn sort-asc-btn ja-sort-btn" data-sort="earned_revenue" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                    <button class="sort-btn sort-desc-btn ja-sort-btn" data-sort="earned_revenue" data-dir="desc" title="Sort descending">‚ñº</button>
                  </div>
                </th>
                <th class="number-col sortable-number" data-sort="over_under_bill">
                  <span class="column-header-text">Over/(Under)</span>
                  <div class="sort-controls inline-sort">
                    <button class="sort-btn sort-asc-btn ja-sort-btn" data-sort="over_under_bill" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                    <button class="sort-btn sort-desc-btn ja-sort-btn" data-sort="over_under_bill" data-dir="desc" title="Sort descending">‚ñº</button>
                  </div>
                </th>
                <th class="number-col sortable-number" data-sort="actual_cost">
                  <span class="column-header-text">Actual Cost</span>
                  <div class="sort-controls inline-sort">
                    <button class="sort-btn sort-asc-btn ja-sort-btn" data-sort="actual_cost" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                    <button class="sort-btn sort-desc-btn ja-sort-btn" data-sort="actual_cost" data-dir="desc" title="Sort descending">‚ñº</button>
                  </div>
                </th>
                <th class="number-col sortable-number" data-sort="percent_complete">
                  <span class="column-header-text">% Complete</span>
                  <div class="sort-controls inline-sort">
                    <button class="sort-btn sort-asc-btn ja-sort-btn" data-sort="percent_complete" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                    <button class="sort-btn sort-desc-btn ja-sort-btn" data-sort="percent_complete" data-dir="desc" title="Sort descending">‚ñº</button>
                  </div>
                </th>
              </tr>
            </thead>
            <tbody id="jobActualsTableBody">
              <tr><td colspan="10" class="loading-cell">Loading job actuals data...</td></tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="job-pagination" id="jaPagination">
          <button id="jaPrevPage" class="pagination-btn" disabled>‚Üê Previous</button>
          <span id="jaPageInfo" class="page-info">Page 1 of 1</span>
          <button id="jaNextPage" class="pagination-btn" disabled>Next ‚Üí</button>
          <select id="jaPageSize" class="page-size-select">
            <option value="25" selected>25 per page</option>
            <option value="50">50 per page</option>
            <option value="100">100 per page</option>
            <option value="250">250 per page</option>
          </select>
        </div>
      </section>

      <!-- ============================================================
           COST CODE ANALYSIS
      ============================================================= -->
      <section id="costCodes" class="dashboard-section">
        <h2>Cost Code Analysis</h2>
        <div class="section-subtitle">Job Cost Breakdown by Category</div>
        <div class="data-as-of">Data as of: <span id="costCodesDataAsOf">-</span></div>

        <!-- Configuration Panel -->
        <div class="config-panel">
          <div class="config-header collapsed" data-target="costCodesConfigBody">
            <span class="config-toggle">‚ñº</span>
            <span class="config-title">Configuration Options</span>
            <button class="config-expand-btn">Expand ‚ñº</button>
          </div>
          <div class="config-body collapsed" id="costCodesConfigBody">
            <div class="job-budgets-controls">
              <div class="overview-config-box">
                <div class="config-label">Job Status:</div>
                <div class="checkbox-stack">
                  <label class="checkbox-label">
                    <input type="checkbox" id="ccStatusActive" checked>
                    Active
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="ccStatusInactive">
                    Inactive
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="ccStatusClosed">
                    Closed
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="ccStatusOverhead">
                    Overhead
                  </label>
                </div>
              </div>

              <div class="overview-config-box job-filter-stack">
                <select id="ccPmFilter" class="filter-select">
                  <option value="">All Project Managers</option>
                </select>
                <select id="ccCustomerFilter" class="filter-select">
                  <option value="">All Clients</option>
                </select>
                <select id="ccJobFilter" class="filter-select">
                  <option value="">All Jobs</option>
                </select>
              </div>

              <div class="overview-config-box">
                <div class="config-label">View Type:</div>
                <div class="radio-stack">
                  <label class="radio-label">
                    <input type="radio" name="ccViewType" id="ccViewSummary" value="summary" checked>
                    Summary by Category
                  </label>
                  <label class="radio-label">
                    <input type="radio" name="ccViewType" id="ccViewDetailed" value="detailed">
                    Detailed by Job
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Key Metrics Row -->
        <div class="cc-metrics-row">
          <div class="cc-metric-card">
            <div class="cc-metric-label">Total Cost</div>
            <div class="cc-metric-value" id="ccTotalCost">$0</div>
          </div>
          <div class="cc-metric-card">
            <div class="cc-metric-label">Cost Categories</div>
            <div class="cc-metric-value" id="ccTotalCategories">0</div>
          </div>
          <div class="cc-metric-card">
            <div class="cc-metric-label">Jobs Analyzed</div>
            <div class="cc-metric-value" id="ccTotalJobs">0</div>
          </div>
          <div class="cc-metric-card highlight">
            <div class="cc-metric-label">Top Category</div>
            <div class="cc-metric-value" id="ccTopCategory">-</div>
            <div class="cc-metric-sub" id="ccTopCategoryPct">0% of total</div>
          </div>
        </div>

        <!-- Quick Actions Bar -->
        <div class="cc-actions-bar">
          <div class="cc-quick-filters">
            <button class="cc-filter-badge active" data-filter="all">All Categories</button>
            <button class="cc-filter-badge" data-filter="top10">Top 10</button>
            <button class="cc-filter-badge" data-filter="high-cost">High Cost (&gt;$100K)</button>
            <button class="cc-filter-badge" data-filter="frequent">Most Used</button>
          </div>
          <div class="cc-export-btns">
            <button class="cc-export-btn" id="ccExportCsv" title="Export to CSV">
              <span>üìÑ</span> CSV
            </button>
            <button class="cc-export-btn" id="ccExportPdf" title="Export to PDF">
              <span>üìë</span> PDF
            </button>
          </div>
        </div>

        <!-- Charts Row -->
        <div class="cc-charts-row">
          <div class="cc-chart-container">
            <div class="cc-chart-header">
              <h3 class="cc-chart-title">Cost Distribution by Category</h3>
              <div class="cc-chart-controls">
                <select id="ccChartType" class="filter-select compact">
                  <option value="bar">Bar Chart</option>
                  <option value="pie">Pie Chart</option>
                  <option value="doughnut">Donut Chart</option>
                </select>
              </div>
            </div>
            <div class="cc-chart-wrapper clickable" id="ccMainChartWrapper">
              <canvas id="ccMainChart"></canvas>
            </div>
            <div class="cc-chart-hint">Click a segment to filter the table</div>
          </div>
          <div class="cc-chart-container">
            <div class="cc-chart-header">
              <h3 class="cc-chart-title">Top 10 Categories</h3>
            </div>
            <div class="cc-chart-wrapper">
              <canvas id="ccTopCategoriesChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Cost Trend Chart -->
        <div class="cc-trend-section">
          <div class="cc-chart-container full-width">
            <div class="cc-chart-header">
              <h3 class="cc-chart-title">Cost Trend Over Time</h3>
              <div class="cc-chart-controls">
                <select id="ccTrendPeriod" class="filter-select compact">
                  <option value="monthly">Monthly</option>
                  <option value="quarterly">Quarterly</option>
                  <option value="yearly">Yearly</option>
                </select>
                <select id="ccTrendDisplay" class="filter-select compact">
                  <option value="top5">Top 5 Categories</option>
                  <option value="top10">Top 10 Categories</option>
                  <option value="total">Total Only</option>
                </select>
              </div>
            </div>
            <div class="cc-chart-wrapper tall">
              <canvas id="ccTrendChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Breakdown Analysis -->
        <div class="cc-breakdown-section">
          <h3 class="cc-section-title">Cost Breakdown Analysis</h3>
          
          <div class="cc-breakdown-grid">
            <!-- By Project Manager -->
            <div class="cc-breakdown-card">
              <div class="cc-breakdown-header">
                <h4>By Project Manager</h4>
                <span class="cc-breakdown-toggle" data-target="ccPmBreakdown">‚ñº</span>
              </div>
              <div class="cc-breakdown-body" id="ccPmBreakdown">
                <table class="cc-breakdown-table">
                  <thead>
                    <tr>
                      <th>Project Manager</th>
                      <th class="number-col">Jobs</th>
                      <th class="number-col">Total Cost</th>
                      <th class="number-col">% of Total</th>
                    </tr>
                  </thead>
                  <tbody id="ccPmBreakdownBody">
                    <tr><td colspan="4" class="loading-cell">Loading...</td></tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- By Client -->
            <div class="cc-breakdown-card">
              <div class="cc-breakdown-header">
                <h4>By Client</h4>
                <span class="cc-breakdown-toggle" data-target="ccClientBreakdown">‚ñº</span>
              </div>
              <div class="cc-breakdown-body" id="ccClientBreakdown">
                <table class="cc-breakdown-table">
                  <thead>
                    <tr>
                      <th>Client</th>
                      <th class="number-col">Jobs</th>
                      <th class="number-col">Total Cost</th>
                      <th class="number-col">% of Total</th>
                    </tr>
                  </thead>
                  <tbody id="ccClientBreakdownBody">
                    <tr><td colspan="4" class="loading-cell">Loading...</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Search Bar -->
        <div class="job-search-bar">
          <input type="text" id="ccSearchInput" placeholder="Search by cost code, description, job, or project manager..." class="job-search-input">
          <span class="job-search-icon">üîç</span>
        </div>

        <!-- Cost Codes Table -->
        <div class="job-table-container">
          <div class="loading-overlay hidden" id="costCodesLoadingOverlay">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading cost code data...</div>
          </div>
          <table class="job-budgets-table" id="costCodesTable">
            <thead>
              <tr id="ccTableHeaderRow">
                <th class="sortable" data-sort="cost_code">
                  <span class="column-header-text">Cost Code</span>
                  <div class="sort-controls inline-sort">
                    <button class="sort-btn sort-asc-btn cc-sort-btn" data-sort="cost_code" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                    <button class="sort-btn sort-desc-btn cc-sort-btn" data-sort="cost_code" data-dir="desc" title="Sort descending">‚ñº</button>
                  </div>
                </th>
                <th class="sortable" data-sort="description">
                  <span class="column-header-text">Description</span>
                  <div class="sort-controls inline-sort">
                    <button class="sort-btn sort-asc-btn cc-sort-btn" data-sort="description" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                    <button class="sort-btn sort-desc-btn cc-sort-btn" data-sort="description" data-dir="desc" title="Sort descending">‚ñº</button>
                  </div>
                </th>
                <th class="sortable number-col" data-sort="job_count">
                  <span class="column-header-text">Jobs</span>
                  <div class="sort-controls inline-sort">
                    <button class="sort-btn sort-asc-btn cc-sort-btn" data-sort="job_count" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                    <button class="sort-btn sort-desc-btn cc-sort-btn" data-sort="job_count" data-dir="desc" title="Sort descending">‚ñº</button>
                  </div>
                </th>
                <th class="sortable number-col" data-sort="entry_count">
                  <span class="column-header-text">Entries</span>
                  <div class="sort-controls inline-sort">
                    <button class="sort-btn sort-asc-btn cc-sort-btn" data-sort="entry_count" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                    <button class="sort-btn sort-desc-btn cc-sort-btn" data-sort="entry_count" data-dir="desc" title="Sort descending">‚ñº</button>
                  </div>
                </th>
                <th class="sortable number-col" data-sort="total_cost">
                  <span class="column-header-text">Total Cost</span>
                  <div class="sort-controls inline-sort">
                    <button class="sort-btn sort-asc-btn cc-sort-btn" data-sort="total_cost" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                    <button class="sort-btn sort-desc-btn cc-sort-btn" data-sort="total_cost" data-dir="desc" title="Sort descending">‚ñº</button>
                  </div>
                </th>
                <th class="sortable number-col" data-sort="avg_per_job">
                  <span class="column-header-text">Avg/Job</span>
                  <div class="sort-controls inline-sort">
                    <button class="sort-btn sort-asc-btn cc-sort-btn" data-sort="avg_per_job" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                    <button class="sort-btn sort-desc-btn cc-sort-btn" data-sort="avg_per_job" data-dir="desc" title="Sort descending">‚ñº</button>
                  </div>
                </th>
                <th class="sortable number-col" data-sort="pct_of_total">
                  <span class="column-header-text">% of Total</span>
                  <div class="sort-controls inline-sort">
                    <button class="sort-btn sort-asc-btn cc-sort-btn" data-sort="pct_of_total" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                    <button class="sort-btn sort-desc-btn cc-sort-btn" data-sort="pct_of_total" data-dir="desc" title="Sort descending">‚ñº</button>
                  </div>
                </th>
                <th class="number-col">Distribution</th>
              </tr>
            </thead>
            <tbody id="costCodesTableBody">
              <tr><td colspan="8" class="loading-cell">Loading cost code data...</td></tr>
            </tbody>
            <tfoot id="costCodesTableFoot">
              <tr class="totals-row">
                <td colspan="2"><strong>Totals</strong></td>
                <td class="number-col" id="ccTotalJobsCell">-</td>
                <td class="number-col" id="ccTotalEntriesCell">-</td>
                <td class="number-col" id="ccTotalCostCell">-</td>
                <td class="number-col">-</td>
                <td class="number-col">100%</td>
                <td></td>
              </tr>
            </tfoot>
          </table>
        </div>

        <!-- Pagination -->
        <div class="job-pagination" id="ccPagination">
          <button id="ccPrevPage" class="pagination-btn" disabled>‚Üê Previous</button>
          <span id="ccPageInfo" class="page-info">Page 1 of 1</span>
          <button id="ccNextPage" class="pagination-btn" disabled>Next ‚Üí</button>
          <select id="ccPageSize" class="page-size-select">
            <option value="25" selected>25 per page</option>
            <option value="50">50 per page</option>
            <option value="100">100 per page</option>
            <option value="all">Show All</option>
          </select>
        </div>

        <!-- AI Analysis Button -->
        <div class="ai-analysis-section">
          <button class="ai-analysis-btn" id="ccAiAnalysisBtn">
            <span class="ai-icon">ü§ñ</span>
            Analyze Cost Codes with AI
          </button>
        </div>

        <!-- Drill-Down Modal for Cost Code Jobs -->
        <div class="cc-modal-overlay hidden" id="ccDrilldownModal">
          <div class="cc-modal">
            <div class="cc-modal-header">
              <h3><span id="ccModalTitle">Cost Code Details</span></h3>
              <button class="cc-modal-close" id="ccModalClose">&times;</button>
            </div>
            <div class="cc-modal-summary">
              <div class="cc-modal-stat">
                <span class="cc-modal-stat-label">Total Cost</span>
                <span class="cc-modal-stat-value" id="ccModalTotalCost">$0</span>
              </div>
              <div class="cc-modal-stat">
                <span class="cc-modal-stat-label">Jobs</span>
                <span class="cc-modal-stat-value" id="ccModalJobCount">0</span>
              </div>
              <div class="cc-modal-stat">
                <span class="cc-modal-stat-label">Entries</span>
                <span class="cc-modal-stat-value" id="ccModalEntryCount">0</span>
              </div>
            </div>
            <div class="cc-modal-body">
              <table class="cc-modal-table">
                <thead>
                  <tr>
                    <th>Job #</th>
                    <th>Description</th>
                    <th>Client</th>
                    <th>Project Manager</th>
                    <th class="number-col">Entries</th>
                    <th class="number-col">Cost</th>
                  </tr>
                </thead>
                <tbody id="ccModalTableBody">
                  <tr><td colspan="6" class="loading-cell">Loading...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- ============================================================
           MISSING BUDGETS
      ============================================================= -->
      <section id="missingBudgets" class="dashboard-section">
        <h2>Missing Budgets</h2>
        <div class="section-subtitle">Foundation</div>
        <div class="data-as-of">Data as of: <span id="missingBudgetsDataAsOf">-</span></div>

        <!-- Configuration Panel -->
        <div class="config-panel">
          <div class="config-header collapsed" data-target="missingBudgetsConfigBody">
            <span class="config-toggle">‚ñº</span>
            <span class="config-title">Configuration Options</span>
            <button class="config-expand-btn">Expand ‚ñº</button>
          </div>
          <div class="config-body collapsed" id="missingBudgetsConfigBody">
            <div class="job-budgets-controls">
              <div class="overview-config-box">
                <div class="config-label">Job Status:</div>
                <div class="checkbox-stack">
                  <label class="checkbox-label">
                    <input type="checkbox" id="mbStatusActive" checked>
                    Active
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="mbStatusInactive">
                    Inactive
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="mbStatusClosed">
                    Closed
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="mbStatusOverhead">
                    Overhead
                  </label>
                </div>
              </div>

              <div class="overview-config-box job-filter-stack">
                <select id="mbPmFilter" class="filter-select">
                  <option value="">All Project Managers</option>
                </select>
                <select id="mbCustomerFilter" class="filter-select">
                  <option value="">All Clients</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <!-- Tabs for Missing Contract vs Missing Cost -->
        <div class="missing-budgets-tabs">
          <button class="mb-tab active" data-tab="noContract">No Contract Value</button>
          <button class="mb-tab" data-tab="noCost">No Estimated Cost</button>
        </div>

        <!-- Search Bar -->
        <div class="job-search-bar">
          <input type="text" id="mbSearchInput" placeholder="Search by job number, description, or client..." class="job-search-input">
          <span class="job-search-icon">üîç</span>
        </div>

        <!-- Jobs Table -->
        <div class="job-table-container">
          <div class="loading-overlay hidden" id="missingBudgetsLoadingOverlay">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading...</div>
          </div>
          <table class="job-budgets-table" id="missingBudgetsTable">
            <thead>
              <tr>
                <th class="sortable" data-sort="job_no">Job #</th>
                <th class="sortable" data-sort="job_description">Description</th>
                <th class="sortable" data-sort="customer_name">Client</th>
                <th class="sortable" data-sort="job_status">Status</th>
                <th class="sortable" data-sort="project_manager_name">Project Manager</th>
                <th class="sortable number-col contract-detail-col hidden" data-sort="original_contract">Original Contract</th>
                <th class="sortable number-col contract-detail-col hidden" data-sort="tot_income_adj">Change Orders</th>
                <th class="sortable number-col revised-contract-col expandable-col" data-sort="revised_contract"><span class="expand-icon" data-expand="mb-contract">‚ñ∂</span> Contract Value</th>
                <th class="sortable number-col cost-detail-col hidden" data-sort="original_cost">Original Cost</th>
                <th class="sortable number-col cost-detail-col hidden" data-sort="tot_cost_adj">Cost Adjustments</th>
                <th class="sortable number-col revised-cost-col expandable-col" data-sort="revised_cost"><span class="expand-icon" data-expand="mb-cost">‚ñ∂</span> Projected Cost</th>
              </tr>
            </thead>
            <tbody id="missingBudgetsTableBody">
              <tr><td colspan="11" class="loading-cell">Loading job data...</td></tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="job-pagination" id="mbPagination">
          <button id="mbPrevPage" class="pagination-btn" disabled>‚Üê Previous</button>
          <span id="mbPageInfo" class="page-info">Page 1 of 1</span>
          <button id="mbNextPage" class="pagination-btn" disabled>Next ‚Üí</button>
          <select id="mbPageSize" class="page-size-select">
            <option value="25" selected>25 per page</option>
            <option value="50">50 per page</option>
            <option value="100">100 per page</option>
            <option value="250">250 per page</option>
          </select>
        </div>
      </section>

      <!-- ============================================================
           PAYMENTS
      ============================================================= -->
      <section id="payments" class="dashboard-section">
        <h2>Payments</h2>
        <div class="data-as-of">Data as of: <span id="paymentsDataAsOf">-</span></div>

        <!-- Search Bar and Column Picker -->
        <div class="table-toolbar">
          <div class="job-search-bar">
            <input type="text" id="paymentsSearchInput" placeholder="Search by vendor, invoice, job, or project manager..." class="job-search-input">
            <span class="job-search-icon">üîç</span>
          </div>
          <div class="column-picker-container">
            <button class="column-picker-btn" id="paymentsColumnPickerBtn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="7" height="7"></rect>
                <rect x="14" y="3" width="7" height="7"></rect>
                <rect x="3" y="14" width="7" height="7"></rect>
                <rect x="14" y="14" width="7" height="7"></rect>
              </svg>
              <span>Columns</span>
            </button>
            <div class="column-picker-dropdown" id="paymentsColumnPickerDropdown">
              <div class="column-picker-header">
                <span class="column-picker-title">Show/Hide Columns</span>
                <button class="column-picker-close" id="paymentsColumnPickerClose">&times;</button>
              </div>
              <div class="column-picker-body" id="paymentsColumnPickerBody">
              </div>
              <div class="column-picker-footer">
                <button class="column-picker-reset" id="paymentsColumnPickerReset">Reset</button>
                <button class="column-picker-apply" id="paymentsColumnPickerApply">Apply</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Payments Table -->
        <div class="job-table-container">
          <div class="loading-overlay hidden" id="paymentsLoadingOverlay">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading...</div>
          </div>
          <table class="job-budgets-table" id="paymentsTable">
            <thead>
              <tr>
                <th class="filterable" data-sort="vendor" data-filter="vendor">
                  <span class="column-header-text">Vendor</span>
                  <div class="column-controls">
                    <div class="sort-controls">
                      <button class="sort-btn sort-asc-btn" data-sort="vendor" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                      <button class="sort-btn sort-desc-btn" data-sort="vendor" data-dir="desc" title="Sort descending">‚ñº</button>
                    </div>
                    <button class="filter-btn" data-filter="vendor" title="Filter">‚ñº</button>
                  </div>
                  <div class="column-filter-dropdown" data-filter="vendor"></div>
                </th>
                <th class="filterable" data-sort="invoice_no" data-filter="invoice_no">
                  <span class="column-header-text">Invoice #</span>
                  <div class="column-controls">
                    <div class="sort-controls">
                      <button class="sort-btn sort-asc-btn" data-sort="invoice_no" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                      <button class="sort-btn sort-desc-btn" data-sort="invoice_no" data-dir="desc" title="Sort descending">‚ñº</button>
                    </div>
                    <button class="filter-btn" data-filter="invoice_no" title="Filter">‚ñº</button>
                  </div>
                  <div class="column-filter-dropdown" data-filter="invoice_no"></div>
                </th>
                <th data-sort="invoice_date">
                  <span class="column-header-text">Invoice Date</span>
                  <div class="column-controls">
                    <div class="sort-controls">
                      <button class="sort-btn sort-asc-btn" data-sort="invoice_date" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                      <button class="sort-btn sort-desc-btn" data-sort="invoice_date" data-dir="desc" title="Sort descending">‚ñº</button>
                    </div>
                  </div>
                </th>
                <th class="filterable" data-sort="job_no" data-filter="job_no">
                  <span class="column-header-text">Job #</span>
                  <div class="column-controls">
                    <div class="sort-controls">
                      <button class="sort-btn sort-asc-btn" data-sort="job_no" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                      <button class="sort-btn sort-desc-btn" data-sort="job_no" data-dir="desc" title="Sort descending">‚ñº</button>
                    </div>
                    <button class="filter-btn" data-filter="job_no" title="Filter">‚ñº</button>
                  </div>
                  <div class="column-filter-dropdown" data-filter="job_no"></div>
                </th>
                <th class="filterable" data-sort="job_description" data-filter="job_description">
                  <span class="column-header-text">Job Desc.</span>
                  <div class="column-controls">
                    <div class="sort-controls">
                      <button class="sort-btn sort-asc-btn" data-sort="job_description" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                      <button class="sort-btn sort-desc-btn" data-sort="job_description" data-dir="desc" title="Sort descending">‚ñº</button>
                    </div>
                    <button class="filter-btn" data-filter="job_description" title="Filter">‚ñº</button>
                  </div>
                  <div class="column-filter-dropdown" data-filter="job_description"></div>
                </th>
                <th class="filterable" data-sort="project_manager" data-filter="project_manager">
                  <span class="column-header-text">Project Manager</span>
                  <div class="column-controls">
                    <div class="sort-controls">
                      <button class="sort-btn sort-asc-btn" data-sort="project_manager" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                      <button class="sort-btn sort-desc-btn" data-sort="project_manager" data-dir="desc" title="Sort descending">‚ñº</button>
                    </div>
                    <button class="filter-btn" data-filter="project_manager" title="Filter">‚ñº</button>
                  </div>
                  <div class="column-filter-dropdown" data-filter="project_manager"></div>
                </th>
                <th class="number-col retention-col" data-sort="non_retention">
                  <span class="column-header-text">Non-Retention</span>
                  <div class="sort-controls inline-sort">
                    <button class="sort-btn sort-asc-btn" data-sort="non_retention" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                    <button class="sort-btn sort-desc-btn" data-sort="non_retention" data-dir="desc" title="Sort descending">‚ñº</button>
                  </div>
                </th>
                <th class="number-col retention-col" data-sort="retention">
                  <span class="column-header-text">Retention</span>
                  <div class="sort-controls inline-sort">
                    <button class="sort-btn sort-asc-btn" data-sort="retention" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                    <button class="sort-btn sort-desc-btn" data-sort="retention" data-dir="desc" title="Sort descending">‚ñº</button>
                  </div>
                </th>
                <th class="number-col" data-sort="invoice_amount">
                  <span class="column-header-text">Invoice Amount</span>
                  <div class="sort-controls inline-sort">
                    <button class="sort-btn sort-asc-btn" data-sort="invoice_amount" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                    <button class="sort-btn sort-desc-btn" data-sort="invoice_amount" data-dir="desc" title="Sort descending">‚ñº</button>
                  </div>
                </th>
                <th class="number-col" data-sort="paid_to_date">
                  <span class="column-header-text">Paid-to-Date</span>
                  <div class="sort-controls inline-sort">
                    <button class="sort-btn sort-asc-btn" data-sort="paid_to_date" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                    <button class="sort-btn sort-desc-btn" data-sort="paid_to_date" data-dir="desc" title="Sort descending">‚ñº</button>
                  </div>
                </th>
                <th class="number-col" data-sort="remaining_balance">
                  <span class="column-header-text">Remaining</span>
                  <div class="sort-controls inline-sort">
                    <button class="sort-btn sort-asc-btn" data-sort="remaining_balance" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                    <button class="sort-btn sort-desc-btn" data-sort="remaining_balance" data-dir="desc" title="Sort descending">‚ñº</button>
                  </div>
                </th>
                <th class="filterable" data-sort="status" data-filter="status">
                  <span class="column-header-text">Status</span>
                  <div class="column-controls">
                    <div class="sort-controls">
                      <button class="sort-btn sort-asc-btn" data-sort="status" data-dir="asc" title="Sort ascending">‚ñ≤</button>
                      <button class="sort-btn sort-desc-btn" data-sort="status" data-dir="desc" title="Sort descending">‚ñº</button>
                    </div>
                    <button class="filter-btn" data-filter="status" title="Filter">‚ñº</button>
                  </div>
                  <div class="column-filter-dropdown" data-filter="status"></div>
                </th>
              </tr>
            </thead>
            <tbody id="paymentsTableBody">
              <tr><td colspan="12" class="loading-cell">Loading invoice data...</td></tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="job-pagination" id="paymentsPagination">
          <button id="paymentsPrevPage" class="pagination-btn" disabled>‚Üê Previous</button>
          <span id="paymentsPageInfo" class="page-info">Page 1 of 1</span>
          <button id="paymentsNextPage" class="pagination-btn" disabled>Next ‚Üí</button>
          <select id="paymentsPageSize" class="page-size-select">
            <option value="25" selected>25 per page</option>
            <option value="50">50 per page</option>
            <option value="100">100 per page</option>
            <option value="250">250 per page</option>
          </select>
        </div>
      </section>

      <!-- ============================================================
           RECEIVABLES/PAYABLES (Under Construction)
      ============================================================= -->
      <section id="receivablesPayables" class="dashboard-section">
        <h2>Receivables/Payables</h2>
        <div class="section-subtitle">Foundation</div>
        <div class="placeholder-content">
          <div class="placeholder-icon">üöß</div>
          <h3>Under Construction</h3>
          <p>This feature is coming soon.</p>
        </div>
      </section>

      <!-- ============================================================
           JOB ANALYTICS (Under Construction)
      ============================================================= -->
      <section id="jobAnalytics" class="dashboard-section">
        <h2>Job Analytics</h2>
        <div class="section-subtitle">Foundation</div>
        <div class="placeholder-content">
          <div class="placeholder-icon">üöß</div>
          <h3>Under Construction</h3>
          <p>This feature is coming soon.</p>
        </div>
      </section>

      <!-- ============================================================
           CASH BALANCES
      ============================================================= -->
      <section id="cashReports" class="dashboard-section">
        <h2>Cash Balances</h2>
        <div class="data-as-of">Data as of: <span id="cashDataAsOf">-</span></div>

        <!-- Configuration Panel -->
        <div class="config-panel">
          <div class="config-header collapsed" data-target="cashConfigBody">
            <span class="config-toggle">‚ñº</span>
            <span class="config-title">Configuration Options</span>
            <button class="config-expand-btn">Expand ‚ñº</button>
          </div>
          <div class="config-body collapsed" id="cashConfigBody">
            <div class="saved-views-row">
              <select id="cashSavedViews" class="saved-views-select">
                <option value="">-- Current Settings --</option>
              </select>
              <button type="button" id="cashSaveViewBtn" class="save-view-btn">Save View</button>
              <button type="button" id="cashDeleteViewBtn" class="delete-view-btn" title="Delete selected view"<svg viewBox="0 0 16 16" width="12" height="12"><path fill="currentColor" d="M2.5 1L8 6.5 13.5 1 15 2.5 9.5 8 15 13.5 13.5 15 8 9.5 2.5 15 1 13.5 6.5 8 1 2.5 2.5 1z"/></svg></button>
            </div>
            <div class="cash-controls">
              <div class="overview-config-box">
                <div style="font-weight: 600; margin-bottom: 8px; color: #374151;">Accounts:</div>
                <div class="account-select-buttons">
                  <button type="button" id="cashSelectAll" class="btn-small">Select All</button>
                  <button type="button" id="cashSelectNone" class="btn-small">Select None</button>
                </div>
                <div id="cashAccountCheckboxes" class="account-checkbox-list">
                  <div class="loading-spinner-small">Loading...</div>
                </div>
              </div>

              <div class="overview-config-box">
                <div style="font-weight: 600; margin-bottom: 8px; color: #374151;">Date Range:</div>
                <div class="dropdown-stack">
                  <div class="dropdown-row">
                    <label>Range:</label>
                    <select id="cashDaysRange">
                      <option value="7">Last 7 Days</option>
                      <option value="14">Last 14 Days</option>
                      <option value="30" selected>Last 30 Days</option>
                      <option value="60">Last 60 Days</option>
                      <option value="90">Last 90 Days</option>
                      <option value="custom">Custom Range</option>
                    </select>
                  </div>
                  <div id="cashCustomDateRange" class="custom-date-range" style="display: none;">
                    <div class="date-input-row">
                      <label>From:</label>
                      <input type="date" id="cashStartDate" class="date-input">
                    </div>
                    <div class="date-input-row">
                      <label>To:</label>
                      <input type="date" id="cashEndDate" class="date-input">
                    </div>
                  </div>
                </div>
              </div>

              <div class="overview-config-box">
                <div style="font-weight: 600; margin-bottom: 8px; color: #374151;">Options:</div>
                <div class="checkbox-stack">
                  <label class="checkbox-label">
                    <input type="checkbox" id="cashStackBars" checked>
                    Stack Bars
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="cashDataLabels">
                    Data Labels
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Current Balances Summary Header -->
        <div id="cashCurrentHeader" class="cash-current-header">
          <div class="loading-spinner">Loading...</div>
        </div>

        <!-- Chart Section -->
        <div class="chart-section cash-chart-section">
          <div class="chart-header">
            <h3>Daily Cash Balances</h3>
            <button class="chart-expand-btn" data-chart="cashChart" data-title="Daily Cash Balances" title="Expand chart"><svg viewBox="0 0 16 16" width="10" height="10"><path fill="currentColor" d="M2 2h5V0H0v7h2V2zm12 0h-5V0h7v7h-2V2zM2 14h5v2H0V9h2v5zm12 0h-5v2h7V9h-2v5z"/></svg></button>
          </div>
          <div class="chart-wrapper">
            <canvas id="cashChart"></canvas>
          </div>
          <div class="cash-summary-tiles" id="cashSummaryTiles">
            <div class="summary-tile">
              <div class="tile-label">Average</div>
              <div class="tile-value" id="cashAvgValue">-</div>
            </div>
            <div class="summary-tile">
              <div class="tile-label">Highest</div>
              <div class="tile-value" id="cashMaxValue">-</div>
              <div class="tile-subvalue" id="cashMaxDate">-</div>
            </div>
            <div class="summary-tile">
              <div class="tile-label">Lowest</div>
              <div class="tile-value" id="cashMinValue">-</div>
              <div class="tile-subvalue" id="cashMinDate">-</div>
            </div>
            <div class="summary-tile">
              <div class="tile-label">Growth</div>
              <div class="tile-value" id="cashGrowthValue">-</div>
            </div>
          </div>
        </div>

        <!-- Data Tables with Tabs -->
        <div class="cash-history-section">
          <div class="cash-tabs">
            <button class="cash-tab active" data-tab="balances">Daily Balances</button>
            <button class="cash-tab" data-tab="transactions">Transactions</button>
          </div>
          <div id="cashTabBalances" class="cash-tab-content active">
            <div class="table-export-header">
              <button class="btn-export-small" id="exportDailyBalancesBtn" title="Export to Excel">
                <svg viewBox="0 0 24 24" width="14" height="14"><path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M12.9,14.5L15.8,19H14L12,15.6L10,19H8.2L11.1,14.5L8.2,10H10L12,13.4L14,10H15.8L12.9,14.5Z"/></svg>
                Export Excel
              </button>
            </div>
            <div id="dailyBalanceTableContainer" class="daily-balance-table-container">
              <div class="loading-spinner">Calculating daily balances...</div>
            </div>
          </div>
          <div id="cashTabTransactions" class="cash-tab-content">
            <div class="transaction-filter-row">
              <label for="transactionFilterInput">Search:</label>
              <input type="text" id="transactionFilterInput" placeholder="Filter by description, account, or amount...">
              <button type="button" class="filter-clear-btn" id="transactionFilterClear">Clear</button>
              <button class="btn-export-small" id="exportTransactionsBtn" title="Export to Excel">
                <svg viewBox="0 0 24 24" width="14" height="14"><path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M12.9,14.5L15.8,19H14L12,15.6L10,19H8.2L11.1,14.5L8.2,10H10L12,13.4L14,10H15.8L12.9,14.5Z"/></svg>
                Export Excel
              </button>
            </div>
            <div id="transactionTableContainer" class="transaction-table-container">
              <div class="loading-spinner">Loading transactions...</div>
            </div>
          </div>
        </div>
      </section>

      <!-- ADMIN SECTION -->
      <section id="admin" class="dashboard-section">
        <h2>User Administration</h2>
        <p class="admin-description">Manage users, roles, and permissions for the FTG Dashboard.</p>
        
        <div class="admin-tabs">
          <button class="admin-tab active" data-tab="users">Users</button>
          <button class="admin-tab" data-tab="roles">Roles</button>
          <button class="admin-tab" data-tab="audit">Audit Log</button>
        </div>
        
        <!-- Users Tab -->
        <div id="adminUsersTab" class="admin-tab-content active">
          <div class="admin-toolbar">
            <button id="addUserBtn" class="btn-primary">+ Add User</button>
            <input type="text" id="userSearchInput" placeholder="Search users..." class="admin-search">
          </div>
          <div id="usersTableContainer" class="admin-table-container">
            <table class="admin-table" id="usersTable">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Role</th>
                  <th>Status</th>
                  <th>Last Login</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="usersTableBody">
                <tr><td colspan="6" class="loading-cell">Loading users...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Roles Tab -->
        <div id="adminRolesTab" class="admin-tab-content">
          <div id="rolesContainer" class="roles-container">
            <div class="loading-spinner">Loading roles...</div>
          </div>
        </div>
        
        <!-- Audit Log Tab -->
        <div id="adminAuditTab" class="admin-tab-content">
          <div class="admin-toolbar">
            <button id="refreshAuditBtn" class="btn-secondary">Refresh</button>
          </div>
          <div id="auditLogContainer" class="admin-table-container">
            <table class="admin-table" id="auditLogTable">
              <thead>
                <tr>
                  <th>Date/Time</th>
                  <th>User</th>
                  <th>Action</th>
                  <th>Details</th>
                  <th>IP Address</th>
                </tr>
              </thead>
              <tbody id="auditLogBody">
                <tr><td colspan="5" class="loading-cell">Loading audit log...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- User Edit Modal -->
  <div id="userModal" class="modal-overlay hidden">
    <div class="modal-content modal-wide">
      <div class="modal-header">
        <h3 id="userModalTitle">Add User</h3>
        <button class="modal-close" onclick="closeUserModal()">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="editUserId" value="">
        <div class="form-row">
          <label for="userDisplayName">Display Name:</label>
          <input type="text" id="userDisplayName" placeholder="John Smith" />
        </div>
        <div class="form-row">
          <label for="userEmail">Email:</label>
          <input type="email" id="userEmail" placeholder="user@ftgbuilders.com" />
        </div>
        <div class="form-row">
          <label for="userRole">Role:</label>
          <select id="userRole">
            <option value="">Select Role...</option>
          </select>
        </div>
        <div class="form-row">
          <label for="userPassword">Password:</label>
          <input type="password" id="userPassword" placeholder="Min 6 characters" />
          <small id="passwordHint" class="form-hint">Leave blank to keep existing password</small>
        </div>
        <div class="form-row">
          <label for="userActive">Status:</label>
          <label class="toggle-switch">
            <input type="checkbox" id="userActive" checked>
            <span class="toggle-slider"></span>
            <span class="toggle-label">Active</span>
          </label>
        </div>
        <div id="userModalError" class="form-error"></div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeUserModal()">Cancel</button>
        <button class="btn-primary" id="saveUserBtn" onclick="saveUser()">Save User</button>
      </div>
    </div>
  </div>

  <!-- Role Modal -->
  <div id="roleModal" class="modal-overlay hidden">
    <div class="modal-content modal-wide">
      <div class="modal-header">
        <h3 id="roleModalTitle">Add Role</h3>
        <button class="modal-close" onclick="closeRoleModal()">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="editRoleId" value="">
        <div class="form-row">
          <label for="roleName">Role Name:</label>
          <input type="text" id="roleName" placeholder="e.g., Accountant" />
        </div>
        <div class="form-row">
          <label for="roleDescription">Description:</label>
          <input type="text" id="roleDescription" placeholder="Brief description of this role" />
        </div>
        <div class="form-row">
          <label>Page Access:</label>
          <div id="rolePermissionsGrid" class="permissions-grid-modal">
          </div>
        </div>
        <div id="roleModalError" class="form-error"></div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeRoleModal()">Cancel</button>
        <button class="btn-primary" id="saveRoleBtn" onclick="saveRole()">Save Role</button>
      </div>
    </div>
  </div>

  <!-- Role Reassignment Modal -->
  <div id="roleReassignModal" class="modal-overlay hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Reassign Users</h3>
        <button class="modal-close" onclick="closeReassignModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p id="reassignMessage" class="reassign-message"></p>
        <div id="reassignUsersList" class="reassign-users-list"></div>
        <input type="hidden" id="reassignRoleId" value="">
        <div class="form-row">
          <label for="reassignNewRole">Reassign users to:</label>
          <select id="reassignNewRole">
            <option value="">Select new role...</option>
          </select>
        </div>
        <div id="reassignModalError" class="form-error"></div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeReassignModal()">Cancel</button>
        <button class="btn-danger" id="confirmReassignBtn" onclick="confirmReassignAndDelete()">Reassign & Delete Role</button>
      </div>
    </div>
  </div>

  <!-- Chart Fullscreen Modal -->
  <div id="chartFullscreenModal" class="chart-fullscreen-modal hidden">
    <div class="chart-fullscreen-header">
      <h3 id="chartFullscreenTitle">Chart</h3>
      <button class="chart-fullscreen-close" onclick="closeChartFullscreen()">&times;</button>
    </div>
    <div class="chart-fullscreen-body">
      <canvas id="chartFullscreenCanvas"></canvas>
    </div>
    <div class="chart-fullscreen-stats" id="chartFullscreenStats"></div>
  </div>

  <!-- Email Modal -->
  <div id="emailModal" class="modal-overlay hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Email Report</h3>
        <button class="modal-close" onclick="closeEmailModal()">&times;</button>
      </div>
      <div class="modal-body">
        <label for="emailTo">Send to:</label>
        <input type="email" id="emailTo" placeholder="recipient@example.com" />
        <label for="emailSubject">Subject:</label>
        <input type="text" id="emailSubject" value="FTG Dashboard Report" />
        <div id="emailStatus" class="email-status"></div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeEmailModal()">Cancel</button>
        <button class="btn-primary" id="sendEmailBtn" onclick="sendReportEmail()">Send Email</button>
      </div>
    </div>
  </div>

  <!-- Schedule Email Modal -->
  <div id="scheduleEmailModal" class="modal-overlay hidden">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h3 id="scheduleModalTitle">Schedule Email Report</h3>
        <button class="modal-close" onclick="closeScheduleEmailModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="schedule-tabs">
          <button class="schedule-tab active" data-tab="create">Create Schedule</button>
          <button class="schedule-tab" data-tab="manage">Manage Schedules</button>
        </div>
        
        <!-- Create Schedule Tab -->
        <div id="createScheduleTab" class="schedule-tab-content">
          <div class="form-row">
            <label for="scheduleReportName">Report Name:</label>
            <input type="text" id="scheduleReportName" placeholder="e.g., Weekly Revenue Report" />
          </div>
          <div class="form-row">
            <label for="scheduleRecipients">Recipients (comma-separated):</label>
            <input type="text" id="scheduleRecipients" placeholder="email1@example.com, email2@example.com" />
          </div>
          <div class="form-row">
            <label for="scheduleFrequency">Frequency:</label>
            <select id="scheduleFrequency">
              <option value="daily">Daily</option>
              <option value="weekly" selected>Weekly</option>
              <option value="monthly">Monthly</option>
            </select>
          </div>
          <div class="form-row" id="scheduleDayOfWeekRow">
            <label for="scheduleDayOfWeek">Day of Week:</label>
            <select id="scheduleDayOfWeek">
              <option value="0">Sunday</option>
              <option value="1" selected>Monday</option>
              <option value="2">Tuesday</option>
              <option value="3">Wednesday</option>
              <option value="4">Thursday</option>
              <option value="5">Friday</option>
              <option value="6">Saturday</option>
            </select>
          </div>
          <div class="form-row hidden" id="scheduleDayOfMonthRow">
            <label for="scheduleDayOfMonth">Day of Month:</label>
            <select id="scheduleDayOfMonth">
              <option value="1">1st</option>
              <option value="15">15th</option>
              <option value="28">28th (last safe day)</option>
            </select>
          </div>
          <div class="form-row">
            <label for="scheduleSendTime">Send Time:</label>
            <input type="time" id="scheduleSendTime" value="08:00" />
          </div>
          <div class="form-row">
            <label class="checkbox-label">
              <input type="checkbox" id="scheduleActive" checked />
              Active (schedule is enabled)
            </label>
          </div>
          <input type="hidden" id="scheduleEditId" value="" />
          <div id="scheduleStatus" class="email-status"></div>
        </div>
        
        <!-- Manage Schedules Tab -->
        <div id="manageSchedulesTab" class="schedule-tab-content hidden">
          <div id="scheduledReportsList" class="scheduled-reports-list">
            <p class="loading-message">Loading scheduled reports...</p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeScheduleEmailModal()">Cancel</button>
        <button class="btn-primary" id="saveScheduleBtn" onclick="saveScheduledReport()">Save Schedule</button>
      </div>
    </div>
  </div>

  <!-- JS LIBRARIES -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>

  <!-- MAIN SCRIPT -->
  <script src="dashboard.js?v=20251216o"></script>
  
  <!-- PWA Service Worker Registration with Aggressive Cache Busting -->
  <script>
    const APP_VERSION = '20251216o';
    
    // Force unregister old service workers and clear caches on every load
    (async function() {
      // Always unregister ALL existing service workers first
      if ('serviceWorker' in navigator) {
        const registrations = await navigator.serviceWorker.getRegistrations();
        for (const reg of registrations) {
          // Unregister any worker that's not our new v5
          if (reg.active && !reg.active.scriptURL.includes('sw-v5.js')) {
            await reg.unregister();
            console.log('Unregistered old service worker');
          }
        }
      }
      
      // Clear all caches on version change
      const storedVersion = localStorage.getItem('ftg_app_version');
      if (storedVersion !== APP_VERSION) {
        console.log('Version changed - clearing all caches');
        if ('caches' in window) {
          const cacheNames = await caches.keys();
          await Promise.all(cacheNames.map(name => caches.delete(name)));
        }
        localStorage.setItem('ftg_app_version', APP_VERSION);
        // Reload only if we had an old version (not first visit)
        if (storedVersion) {
          window.location.reload(true);
          return;
        }
      }
      localStorage.setItem('ftg_app_version', APP_VERSION);
    })();
    
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        try {
          // Register NEW service worker at NEW path - forces Safari to get fresh worker
          const registration = await navigator.serviceWorker.register('/sw-v5.js');
          console.log('SW registered:', registration.scope);
          
          // Check for updates every 5 minutes
          setInterval(() => {
            registration.update();
          }, 5 * 60 * 1000);
          
          registration.addEventListener('updatefound', () => {
            const newWorker = registration.installing;
            newWorker.addEventListener('statechange', () => {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                showUpdateNotification();
              }
            });
          });
        } catch (error) {
          console.log('SW registration failed:', error);
        }
      });
    }
    
    function showUpdateNotification() {
      const banner = document.createElement('div');
      banner.className = 'update-banner';
      banner.innerHTML = `
        <span>New version available!</span>
        <button onclick="location.reload()">Refresh</button>
      `;
      document.body.appendChild(banner);
    }
    
    async function requestNotificationPermission() {
      if ('Notification' in window && Notification.permission === 'default') {
        const permission = await Notification.requestPermission();
        return permission === 'granted';
      }
      return Notification.permission === 'granted';
    }
    
    function setBadge(count) {
      if ('setAppBadge' in navigator) {
        if (count > 0) {
          navigator.setAppBadge(count);
        } else {
          navigator.clearAppBadge();
        }
      }
    }
  </script>
</body>
</html>
